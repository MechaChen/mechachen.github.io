"use strict";(self.webpackChunkbenson_doc=self.webpackChunkbenson_doc||[]).push([[5438],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),c=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},m="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(a),d=r,u=m["".concat(o,".").concat(d)]||m[d]||g[d]||s;return a?n.createElement(u,i(i({ref:t},p),{},{components:a})):n.createElement(u,i({ref:t},p))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=d;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<s;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},2394:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>g,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var n=a(7462),r=(a(7294),a(3905));const s={sidebar_position:1.3,sidebar_label:"[Chat App] Architecture - Message Syncer and Optimistic Update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",tags:["System Design","Architecture"]},i=void 0,l={unversionedId:"Plan/chat-system-architecture-message-scheduler-and-optimistic-update",id:"Plan/chat-system-architecture-message-scheduler-and-optimistic-update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",description:"Message Syncer and Optimistic Update",source:"@site/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update.mdx",sourceDirName:"Plan",slug:"/Plan/chat-system-architecture-message-scheduler-and-optimistic-update",permalink:"/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update.mdx",tags:[{label:"System Design",permalink:"/docs/tags/system-design"},{label:"Architecture",permalink:"/docs/tags/architecture"}],version:"current",lastUpdatedAt:1749998166,formattedLastUpdatedAt:"Jun 15, 2025",sidebarPosition:1.3,frontMatter:{sidebar_position:1.3,sidebar_label:"[Chat App] Architecture - Message Syncer and Optimistic Update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",tags:["System Design","Architecture"]},sidebar:"tutorialSidebar",previous:{title:"[Chat App] Architecture - Network",permalink:"/docs/Plan/chat-system-architecture-network"},next:{title:"[Chat App] Architecture - High Level Design",permalink:"/docs/Plan/chat-system-architecture-high-level-design"}},o={},c=[{value:"Message Syncer and Optimistic Update",id:"message-syncer-and-optimistic-update",level:2},{value:"Message Syncing process",id:"message-syncing-process",level:2},{value:"\u23f3<strong>Pending message</strong>",id:"pending-message",level:3},{value:"\ud83d\udd52 <strong>In-Flight message</strong>",id:"-in-flight-message",level:3},{value:"\u2705 <strong>Success message</strong>",id:"-success-message",level:3},{value:"\u274c <strong>Failed message</strong>",id:"-failed-message",level:3},{value:"Reference",id:"reference",level:2}],p={toc:c},m="wrapper";function g(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"message-syncer-and-optimistic-update"},"Message Syncer and Optimistic Update"),(0,r.kt)("p",null,"When the user sends out a message (or any update made by the user in general), we want to reflect the changes immediately. It is poor user experience to wait for the server's confirmation before showing an updated UI."),(0,r.kt)("br",null),(0,r.kt)("p",null,"Hence outgoing chat messages/user actions are "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"inserted into the Client side storage instead and then marked as pending. "),(0,r.kt)("li",{parentName:"ol"},"Pending messages are also reflected immediately in the UI. "),(0,r.kt)("li",{parentName:"ol"},"And we can utilize the message status to indicate the various message delivery statuses.")),(0,r.kt)("br",null),(0,r.kt)("p",null,"Here are the message statuses:"),(0,r.kt)("br",null),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Message Status"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Messenger"),(0,r.kt)("th",{parentName:"tr",align:null},"WhatsApp"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Sending"),(0,r.kt)("td",{parentName:"tr",align:null},"Application is attempting to send the message"),(0,r.kt)("td",{parentName:"tr",align:null},"Empty circle"),(0,r.kt)("td",{parentName:"tr",align:null},"Clock icon")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"In-Flight"),(0,r.kt)("td",{parentName:"tr",align:null},"Message was sent to the server successfully"),(0,r.kt)("td",{parentName:"tr",align:null},"Checkmark in outline circle"),(0,r.kt)("td",{parentName:"tr",align:null},"Single gray checkmark")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Success"),(0,r.kt)("td",{parentName:"tr",align:null},"Message delivered to the recipients and stored in the server"),(0,r.kt)("td",{parentName:"tr",align:null},"Checkmark in filled circle"),(0,r.kt)("td",{parentName:"tr",align:null},"Double gray checkmark")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Failed"),(0,r.kt)("td",{parentName:"tr",align:null},"Message failed to send"),(0,r.kt)("td",{parentName:"tr",align:null},"Exclamation icon in circle"),(0,r.kt)("td",{parentName:"tr",align:null},"Exclamation icon in circle")))),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"message-syncing-process"},"Message Syncing process"),(0,r.kt)("p",null,"Here are the message syncer components:"),(0,r.kt)("img",{width:"200px",src:"/img/message_syncer_components.jpg",alt:"Message Syncer Components"}),(0,r.kt)("br",null),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\ud83d\udc64 ",(0,r.kt)("strong",{parentName:"li"},"Client"),"\uff1a The user device or app."),(0,r.kt)("li",{parentName:"ul"},"\ud83d\udcac ",(0,r.kt)("strong",{parentName:"li"},"Raw message"),"\uff1a The original message before processing."),(0,r.kt)("li",{parentName:"ul"},"\u23f1\ufe0f ",(0,r.kt)("strong",{parentName:"li"},"Message with status"),"\uff1a A message marked as pending, in-flight, success, or failed."),(0,r.kt)("li",{parentName:"ul"},"\ud83d\udd04 ",(0,r.kt)("strong",{parentName:"li"},"Message Syncer"),"\uff1a The component that syncs messages with the server."),(0,r.kt)("li",{parentName:"ul"},"\ud83d\uddc4\ufe0f ",(0,r.kt)("strong",{parentName:"li"},"Client Storage"),"\uff1a Local storage used to persist message states."),(0,r.kt)("li",{parentName:"ul"},"\ud83d\udda5\ufe0f ",(0,r.kt)("strong",{parentName:"li"},"Server"),"\uff1a The backend server that processes and stores the messages.")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"pending-message"},"\u23f3",(0,r.kt)("strong",{parentName:"h3"},"Pending message")),(0,r.kt)("img",{width:"500px",src:"/img/message_syncer_pending.jpg",alt:"Pending Message"}),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Client")," sends a ",(0,r.kt)("strong",{parentName:"li"},"raw message"),"."),(0,r.kt)("li",{parentName:"ol"},"It is forwarded to the ",(0,r.kt)("strong",{parentName:"li"},"Message Syncer"),"."),(0,r.kt)("li",{parentName:"ol"},"The Syncer wraps it with a ",(0,r.kt)("strong",{parentName:"li"},'"pending"')," status."),(0,r.kt)("li",{parentName:"ol"},"It is stored in the ",(0,r.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,r.kt)("li",{parentName:"ol"},"The Syncer prepares to sync the message with the ",(0,r.kt)("strong",{parentName:"li"},"Server"),".")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"-in-flight-message"},"\ud83d\udd52 ",(0,r.kt)("strong",{parentName:"h3"},"In-Flight message")),(0,r.kt)("img",{width:"500px",src:"/img/message_syncer_in_flight.jpg",alt:"In-Flight Message"}),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Message Syncer")," initiates communication with the ",(0,r.kt)("strong",{parentName:"li"},"Server"),"."),(0,r.kt)("li",{parentName:"ol"},"The message is in the process of being synced."),(0,r.kt)("li",{parentName:"ol"},"While waiting for the response, it is stored in ",(0,r.kt)("strong",{parentName:"li"},"Client Storage")," and marked as ",(0,r.kt)("strong",{parentName:"li"},'"in-flight"'),"."),(0,r.kt)("li",{parentName:"ol"},"The UI fetches the message from local storage and shows a ",(0,r.kt)("strong",{parentName:"li"},'"sending"')," indicator."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Client")," sees the message as sent, but not yet confirmed.")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"-success-message"},"\u2705 ",(0,r.kt)("strong",{parentName:"h3"},"Success message")),(0,r.kt)("img",{width:"500px",src:"/img/message_syncer_success.jpg",alt:"Success Message"}),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Message Syncer")," fetches updates from the ",(0,r.kt)("strong",{parentName:"li"},"Server"),"."),(0,r.kt)("li",{parentName:"ol"},"Upon success, it writes the message into the ",(0,r.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,r.kt)("li",{parentName:"ol"},"The message is then read from Client Storage and marked as ",(0,r.kt)("strong",{parentName:"li"},'"delivered"'),"."),(0,r.kt)("li",{parentName:"ol"},"The UI displays the message with a ",(0,r.kt)("strong",{parentName:"li"},"success status"),"."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Client")," sees the message marked with a green check (successfully sent).")),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"-failed-message"},"\u274c ",(0,r.kt)("strong",{parentName:"h3"},"Failed message")),(0,r.kt)("img",{width:"500px",src:"/img/message_syncer_failed.jpg",alt:"Failed Message"}),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Message Syncer")," tries to sync with the ",(0,r.kt)("strong",{parentName:"li"},"Server"),"."),(0,r.kt)("li",{parentName:"ol"},"Syncing fails (e.g., due to a network or server issue)."),(0,r.kt)("li",{parentName:"ol"},"The message remains in ",(0,r.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,r.kt)("li",{parentName:"ol"},"The system reads the message from storage and marks it as ",(0,r.kt)("strong",{parentName:"li"},'"failed"'),"."),(0,r.kt)("li",{parentName:"ol"},"The ",(0,r.kt)("strong",{parentName:"li"},"Client UI")," displays the message with a ",(0,r.kt)("strong",{parentName:"li"},"failure icon"),", often with a retry option.")),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GreatFrontend - Chat App")),(0,r.kt)("br",null),(0,r.kt)("br",null))}g.isMDXComponent=!0}}]);