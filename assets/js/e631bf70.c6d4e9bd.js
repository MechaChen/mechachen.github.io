"use strict";(self.webpackChunkbenson_doc=self.webpackChunkbenson_doc||[]).push([[5438],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),g=p(a),u=s,d=g["".concat(o,".").concat(u)]||g[u]||m[u]||r;return a?n.createElement(d,i(i({ref:t},c),{},{components:a})):n.createElement(d,i({ref:t},c))}));function d(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,i=new Array(r);i[0]=u;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[g]="string"==typeof e?e:s,i[1]=l;for(var p=2;p<r;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2394:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var n=a(7462),s=(a(7294),a(3905));const r={sidebar_position:1.2,sidebar_label:"[Chat App] Architecture - Message Syncer and Optimistic Update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",tags:["System Design","Architecture"]},i=void 0,l={unversionedId:"Plan/chat-system-architecture-message-scheduler-and-optimistic-update",id:"Plan/chat-system-architecture-message-scheduler-and-optimistic-update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",description:"Message Syncer and Optimistic Update",source:"@site/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update.mdx",sourceDirName:"Plan",slug:"/Plan/chat-system-architecture-message-scheduler-and-optimistic-update",permalink:"/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Plan/chat-system-architecture-message-scheduler-and-optimistic-update.mdx",tags:[{label:"System Design",permalink:"/docs/tags/system-design"},{label:"Architecture",permalink:"/docs/tags/architecture"}],version:"current",lastUpdatedAt:1749998166,formattedLastUpdatedAt:"Jun 15, 2025",sidebarPosition:1.2,frontMatter:{sidebar_position:1.2,sidebar_label:"[Chat App] Architecture - Message Syncer and Optimistic Update",title:"[Chat App] Architecture - Message Syncer and Optimistic Update",tags:["System Design","Architecture"]},sidebar:"tutorialSidebar",previous:{title:"[Chat App] Architecture - High Level Design",permalink:"/docs/Plan/chat-system-architecture-high-level-design"},next:{title:"[Chat App] Architecture - Network",permalink:"/docs/Plan/chat-system-architecture-network"}},o={},p=[{value:"Message Syncer and Optimistic Update",id:"message-syncer-and-optimistic-update",level:2},{value:"Message Syncing process",id:"message-syncing-process",level:2},{value:"\u23f3<strong>Pending message</strong>",id:"pending-message",level:3},{value:"\ud83d\udd52 <strong>In-Flight message</strong>",id:"-in-flight-message",level:3},{value:"\u2705 <strong>Success message</strong>",id:"-success-message",level:3},{value:"\u274c <strong>Failed message</strong>",id:"-failed-message",level:3},{value:"Reference",id:"reference",level:2}],c={toc:p},g="wrapper";function m(e){let{components:t,...a}=e;return(0,s.kt)(g,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"message-syncer-and-optimistic-update"},"Message Syncer and Optimistic Update"),(0,s.kt)("p",null,"When the user sends out a message (or any update made by the user in general), we want to reflect the changes immediately. It is poor user experience to wait for the server's confirmation before showing an updated UI."),(0,s.kt)("br",null),(0,s.kt)("p",null,"Hence outgoing chat messages/user actions are "),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"inserted into the Client side storage instead and then marked as pending. "),(0,s.kt)("li",{parentName:"ol"},"Pending messages are also reflected immediately in the UI. "),(0,s.kt)("li",{parentName:"ol"},"And we can utilize the message status to indicate the various message delivery statuses.")),(0,s.kt)("br",null),(0,s.kt)("p",null,"Here are the message statuses:"),(0,s.kt)("br",null),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"Message Status"),(0,s.kt)("th",{parentName:"tr",align:null},"Description"),(0,s.kt)("th",{parentName:"tr",align:null},"Messenger"),(0,s.kt)("th",{parentName:"tr",align:null},"WhatsApp"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Sending"),(0,s.kt)("td",{parentName:"tr",align:null},"Application is attempting to send the message"),(0,s.kt)("td",{parentName:"tr",align:null},"Empty circle"),(0,s.kt)("td",{parentName:"tr",align:null},"Clock icon")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"In-Flight"),(0,s.kt)("td",{parentName:"tr",align:null},"Message was sent to the server successfully"),(0,s.kt)("td",{parentName:"tr",align:null},"Checkmark in outline circle"),(0,s.kt)("td",{parentName:"tr",align:null},"Single gray checkmark")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Success"),(0,s.kt)("td",{parentName:"tr",align:null},"Message delivered to the recipients and stored in the server"),(0,s.kt)("td",{parentName:"tr",align:null},"Checkmark in filled circle"),(0,s.kt)("td",{parentName:"tr",align:null},"Double gray checkmark")),(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},"Failed"),(0,s.kt)("td",{parentName:"tr",align:null},"Message failed to send"),(0,s.kt)("td",{parentName:"tr",align:null},"Exclamation icon in circle"),(0,s.kt)("td",{parentName:"tr",align:null},"Exclamation icon in circle")))),(0,s.kt)("br",null),(0,s.kt)("h2",{id:"message-syncing-process"},"Message Syncing process"),(0,s.kt)("p",null,"Here are the message syncer components:"),(0,s.kt)("img",{width:"200px",src:"/img/message_syncer_components.jpg",alt:"Message Syncer Components"}),(0,s.kt)("br",null),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\ud83d\udc64 ",(0,s.kt)("strong",{parentName:"li"},"Client"),"\uff1a The user device or app."),(0,s.kt)("li",{parentName:"ul"},"\ud83d\udcac ",(0,s.kt)("strong",{parentName:"li"},"Raw message"),"\uff1a The original message before processing."),(0,s.kt)("li",{parentName:"ul"},"\u23f1\ufe0f ",(0,s.kt)("strong",{parentName:"li"},"Message with status"),"\uff1a A message marked as pending, in-flight, success, or failed."),(0,s.kt)("li",{parentName:"ul"},"\ud83d\udd04 ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer"),"\uff1a The component that syncs messages with the server."),(0,s.kt)("li",{parentName:"ul"},"\ud83d\uddc4\ufe0f ",(0,s.kt)("strong",{parentName:"li"},"Client Storage"),"\uff1a Local storage used to persist message states."),(0,s.kt)("li",{parentName:"ul"},"\ud83d\udda5\ufe0f ",(0,s.kt)("strong",{parentName:"li"},"Server"),"\uff1a The backend server that processes and stores the messages.")),(0,s.kt)("br",null),(0,s.kt)("h3",{id:"pending-message"},"\u23f3",(0,s.kt)("strong",{parentName:"h3"},"Pending message")),(0,s.kt)("img",{width:"500px",src:"/img/message_syncer_pending.jpg",alt:"Pending Message"}),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Client")," sends a ",(0,s.kt)("strong",{parentName:"li"},"raw message"),"."),(0,s.kt)("li",{parentName:"ol"},"It is forwarded to the ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer"),"."),(0,s.kt)("li",{parentName:"ol"},"The Syncer wraps it with a ",(0,s.kt)("strong",{parentName:"li"},'"pending"')," status."),(0,s.kt)("li",{parentName:"ol"},"It is stored in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,s.kt)("li",{parentName:"ol"},"The Syncer prepares to sync the message with the ",(0,s.kt)("strong",{parentName:"li"},"Server"),".")),(0,s.kt)("br",null),(0,s.kt)("h3",{id:"-in-flight-message"},"\ud83d\udd52 ",(0,s.kt)("strong",{parentName:"h3"},"In-Flight message")),(0,s.kt)("img",{width:"500px",src:"/img/message_syncer_in_flight.jpg",alt:"In-Flight Message"}),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," process the message which is sent back from ",(0,s.kt)("strong",{parentName:"li"},"Server"),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then get the ",(0,s.kt)("strong",{parentName:"li"},'"pending"')," message in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage")," by the message id."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then update the message status to ",(0,s.kt)("strong",{parentName:"li"},'"in-flight"')," in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,s.kt)("li",{parentName:"ol"},"The Message status is updated as ",(0,s.kt)("strong",{parentName:"li"},'"in-flight"'),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Client")," sees the message as ",(0,s.kt)("strong",{parentName:"li"},'"in-flight"')," status.")),(0,s.kt)("br",null),(0,s.kt)("h3",{id:"-success-message"},"\u2705 ",(0,s.kt)("strong",{parentName:"h3"},"Success message")),(0,s.kt)("img",{width:"500px",src:"/img/message_syncer_success.jpg",alt:"Success Message"}),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," process the message which is sent back from ",(0,s.kt)("strong",{parentName:"li"},"Server"),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then get the ",(0,s.kt)("strong",{parentName:"li"},'"in-flight"')," message in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage")," by the message id."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then update the message status to ",(0,s.kt)("strong",{parentName:"li"},'"success"')," in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,s.kt)("li",{parentName:"ol"},"The Message status is updated as ",(0,s.kt)("strong",{parentName:"li"},'"success"'),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Client")," sees the message as ",(0,s.kt)("strong",{parentName:"li"},'"success"')," status.")),(0,s.kt)("br",null),(0,s.kt)("h3",{id:"-failed-message"},"\u274c ",(0,s.kt)("strong",{parentName:"h3"},"Failed message")),(0,s.kt)("img",{width:"500px",src:"/img/message_syncer_failed.jpg",alt:"Failed Message"}),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," process the message which is sent back from ",(0,s.kt)("strong",{parentName:"li"},"Server"),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then get the ",(0,s.kt)("strong",{parentName:"li"},'"in-flight"')," message in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage")," by the message id."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Message Syncer")," then update the message status to ",(0,s.kt)("strong",{parentName:"li"},'"failed"')," in the ",(0,s.kt)("strong",{parentName:"li"},"Client Storage"),"."),(0,s.kt)("li",{parentName:"ol"},"The Message status is updated as ",(0,s.kt)("strong",{parentName:"li"},'"failed"'),"."),(0,s.kt)("li",{parentName:"ol"},"The ",(0,s.kt)("strong",{parentName:"li"},"Client")," sees the message as ",(0,s.kt)("strong",{parentName:"li"},'"failed"')," status.")),(0,s.kt)("br",null),(0,s.kt)("br",null),(0,s.kt)("h2",{id:"reference"},"Reference"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"GreatFrontend - Chat App")),(0,s.kt)("br",null),(0,s.kt)("br",null))}m.isMDXComponent=!0}}]);