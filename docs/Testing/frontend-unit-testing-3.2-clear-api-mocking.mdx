---
sidebar_position: 0
sidebar__label: '[Unit Test] 3.2 - æ¯å€‹æ¸¬è©¦éƒ½è©²æ˜¯ç¨ç«‹çš„ï¼Œé‚£äº›ä½ è©²æ¸…çš„ api mock data'
title: '[Unit Test] 3.2 - æ¯å€‹æ¸¬è©¦éƒ½è©²æ˜¯ç¨ç«‹çš„ï¼Œé‚£äº›ä½ è©²æ¸…çš„ api mock data'

---


## ç‚ºä»€éº¼è¦æ¸…é™¤ mocking api functionï¼Ÿ

å…ˆèªªæœ€çµ‚ç›®çš„ï¼š**é¿å…æ¯å€‹ test case çš„çµæœäº’ç›¸å¹²æ“¾**

åœ¨å–®å…ƒæ¸¬è©¦çš„è—è¡“ä¸­ (Section 8.2.4) ä¸­æœ‰æåˆ°ï¼š

> Laziness in cleanupâ€”If youâ€™re too lazy to clean up your database after testing,
your filesystem after testing, or your memory-based objects, consider moving to
a different profession. This isnâ€™t a job for you

<br />

æ„æ€å°±æ˜¯ï¼š
> å¦‚æœä½ åœ¨æ¸¬è©¦å¾Œå¤ªæ‡¶æƒ°ä»¥è‡³æ–¼ä¸æ¸…ç†ä½ çš„æ•¸æ“šåº«ã€æ–‡ä»¶ç³»çµ±æˆ–åŸºæ–¼å…§å­˜çš„å°è±¡ï¼Œé‚£éº¼è€ƒæ…®è½‰è¡Œã€‚é€™å€‹å·¥ä½œä¸é©åˆä½ 

<br />

é›–ç„¶é€™å¥è©±é‚„è »é‡ ğŸ˜± çš„ï¼Œä¸éä¹Ÿå¤§å¤§å‡¸é¡¯å‡ºæ¸…é™¤æ¸¬è©¦è³‡æ–™çš„é‡è¦æ€§ï¼Œç•¶æˆ‘å€‘å–®å…ƒæ¸¬è©¦çš„æ¸¬è©¦è³‡æ–™äº’ç›¸å¹²æ“¾æ™‚ï¼Œæˆ‘å€‘æœ€å¾Œæ¸¬å‡ºçš„çµæœå°±ä¸æœƒæ˜¯æº–ç¢ºçš„ï¼Œå°±ç„¡æ³•å…·æœ‰ **å¯ä¿¡ä»»çš„** çš„ç‰¹æ€§ï¼Œé‚£æˆ‘å€‘åšçš„æ¸¬è©¦å…¶å¯¦å°±æ²’æœ‰æ„ç¾©äº†



<br />


## ä¸åŒçš„ clean up utils
ç•¶æˆ‘å€‘åœ¨ mocking api æ™‚ï¼Œæ˜¯å°‡ api function è¦†å¯«æˆ `jest.fn`ï¼Œæ¥è‘—åœ¨ `jest.fn` å®¢è£½åŒ–æˆ‘å€‘çš„ api response

`jest.fn` æœƒå»è¨˜éŒ„ä¸€äº›æˆ‘å€‘ call api çš„éç¨‹ï¼Œåƒæ˜¯ï¼š
- å‘¼å«äº†å¹¾æ¬¡
- å‘¼å«æ™‚å¸¶äº†ä»€éº¼åƒæ•¸

<br />

é€™æ™‚å€™ï¼Œæˆ‘å€‘å°±å¯ä»¥åˆ©ç”¨ä»¥ä¸‹ä¸‰å€‹ utils ä¾†å¹«æˆ‘å€‘æ¸…é™¤æ¯å€‹ test cases ä¸åŒé¡å‹çš„è³‡æ–™ï¼š

- `mock.mockClear()`
- `mock.mockReset()`
- `mock.mockRestore()`

é€™ä¸‰å€‹ util å„æœ‰ä¸åŒçš„ä¸»è¦åŠŸèƒ½ï¼Œå°±è®“æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹å§ï½

<br />


### `mock.mockClear()`

æœƒè¦†å¯«æ‰ mock api ç›¸é—œçš„ç´€éŒ„ï¼Œåƒæ˜¯ **å‘¼å«çš„æ¬¡æ•¸**ã€**ç”¢ç”Ÿçš„å¯¦ä¾‹æ•¸é‡** ç­‰ï¼Œä½†ä¸æœƒæ¸…é™¤éœ€è¦å¼•å…¥çš„ input æˆ–è¼¸å‡ºçš„ output ç­‰æ¢ä»¶


<table>
    <thead>
        <tr>
            <th align="center">ä¸»è¦ç›®çš„</th>
            <th align="center">mock å€¼</th>
            <th align="center">æ˜¯å¦è¢«ç§»é™¤</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="center" rowspan="3">å‘¼å«å¾Œç›¸é—œç´€éŒ„</td>
            <td align="center"><code>mockFn.mock.calls</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.instances</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.contexts</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center" rowspan="3">æ¨¡æ“¬ function è¡Œç‚º</td>
            <td align="center"><code>mockFn.mockImplementation()</code></td>
            <td align="center">âŒ</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockReturnValue()</code></td>
            <td align="center">âŒ</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockResolvedValue()</code></td>
            <td align="center">âŒ</td>
        </tr>
        <tr>
            <td align="center">é‚„åŸ function</td>
            <td align="center"><code>jest.fn()</code></td>
            <td align="center">âŒ</td>
        </tr>
    </tbody>
</table>


<br /><br />

### `mock.mockReset()`

æœƒè¦†å¯«æ‰ mock api ç›¸é—œçš„ç´€éŒ„ï¼Œåƒæ˜¯ **å‘¼å«çš„æ¬¡æ•¸**ã€**ç”¢ç”Ÿçš„å¯¦ä¾‹æ•¸é‡** ç­‰ï¼Œä¹Ÿæœƒæ¸…é™¤éœ€è¦å¼•å…¥çš„ input æˆ–è¼¸å‡ºçš„ output ç­‰æ¢ä»¶ï¼ŒæŠŠ `jest.fn` è®Šæˆ `undefined`


<table>
    <thead>
        <tr>
            <th align="center">ä¸»è¦ç›®çš„</th>
            <th align="center">mock å€¼</th>
            <th align="center">æ˜¯å¦è¢«ç§»é™¤</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="center" rowspan="3">å‘¼å«å¾Œç›¸é—œç´€éŒ„</td>
            <td align="center"><code>mockFn.mock.calls</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.instances</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.contexts</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center" rowspan="3">æ¨¡æ“¬ function è¡Œç‚º</td>
            <td align="center"><code>mockFn.mockImplementation()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockReturnValue()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockResolvedValue()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center">é‚„åŸ function</td>
            <td align="center"><code>jest.fn()</code></td>
            <td align="center">âŒ</td>
        </tr>
    </tbody>
</table>


<br /><br />

### `mock.mockRestore()`

æœƒè¦†å¯«æ‰ mock api ç›¸é—œçš„ç´€éŒ„ï¼Œåƒæ˜¯ **å‘¼å«çš„æ¬¡æ•¸**ã€**ç”¢ç”Ÿçš„å¯¦ä¾‹æ•¸é‡** ç­‰ï¼Œä¹Ÿæœƒæ¸…é™¤éœ€è¦å¼•å…¥çš„ input æˆ–è¼¸å‡ºçš„ output ç­‰æ¢ä»¶ï¼Œç”šè‡³é‚„åŸæˆåŸæœ¬çš„ functionï¼Œä¸å†æ˜¯ `jest.fn`



<table>
    <thead>
        <tr>
            <th align="center">ä¸»è¦ç›®çš„</th>
            <th align="center">mock å€¼</th>
            <th align="center">æ˜¯å¦è¢«ç§»é™¤</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="center" rowspan="3">å‘¼å«å¾Œç›¸é—œç´€éŒ„</td>
            <td align="center"><code>mockFn.mock.calls</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.instances</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mock.contexts</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center" rowspan="3">æ¨¡æ“¬ function è¡Œç‚º</td>
            <td align="center"><code>mockFn.mockImplementation()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockReturnValue()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center"><code>mockFn.mockResolvedValue()</code></td>
            <td align="center">âœ…</td>
        </tr>
        <tr>
            <td align="center">é‚„åŸ function</td>
            <td align="center"><code>jest.fn()</code></td>
            <td align="center">âœ…</td>
        </tr>
    </tbody>
</table>

<br /><br />


:::infoæ³¨æ„ï¼š**æ­¤å‡½å¼åœ¨ä½¿ç”¨ `jest.spyOn` ä¸‹æ‰å¯ä»¥ä½¿ç”¨ï¼Œä¸€èˆ¬çš„ `jest.fn()` ç„¡æ³•ä½¿ç”¨æ­¤å‡½å¼**
:::

<br />


## å¯¦éš›ä½¿ç”¨

åœ¨æˆ‘ç¾åœ¨çš„é–‹ç™¼ç¶“é©—ä¸­ï¼Œæˆ‘å€‘çš„æƒ…å¢ƒåªéœ€è¦å»æ¸…é™¤ **å‘¼å«çš„ç›¸é—œç´€éŒ„**ï¼Œæ‰€ä»¥æˆ‘å€‘é¸ç”¨äº† `mock.mockClear` ä¾†ä½œç‚º clear api çš„ç´€éŒ„ï¼Œä¸ç”¨å¦å¤–å»æ¸…é™¤ api response

ä»¥ä¸‹ç‚ºå¯¦éš›ç¯„ä¾‹ï¼š


```js
describe('ThirdPartySources', () => {
  beforeEach(() => {
    mockApiGetUsers.mockResolvedValue(defaultMockApiGetUsers);
  });

  afterEach(() => {
    mockApiGetUsers.mockClear();
  });

  test('when there is no azure, okta is in ad sources, should show refresh status button', async () => {
    // Act
    const { findByTestId } = renderWithRedux(<ThirdPartySources></ThirdPartySources>);
    const refreshBtn = await findByTestId(idBtnConnectionStatus);

    // Assert
    expect(refreshBtn).toBeVisible();
  });
});
```

<br />

## çµè«–
- çŸ¥é“æ¸…é™¤ mock data çš„é‡è¦æ€§ï¼Œæ˜¯ç‚ºäº†è¦ä¿æŒæ¯å€‹å–®å…ƒæ¸¬è©¦ç¨ç«‹é‹ä½œ
- çŸ¥é“ jest æä¾› 3 å€‹ util å¹«åŠ©æˆ‘å€‘æ¸…ç† mock dataï¼Œä»¥å¯¦å‹™ä¸Šä¾†èªª `mock.mockClear()` æœ€å¸¸ç”¨

<br />

### åƒè€ƒè³‡è¨Š
- [Jest - Mock Functions](https://jestjs.io/docs/mock-function-api#mockfnmockclear)
- [å–®å…ƒæ¸¬è©¦çš„è—è¡“](https://www.tenlong.com.tw/products/9787115360359?list_name=c-unit-test)

<br />