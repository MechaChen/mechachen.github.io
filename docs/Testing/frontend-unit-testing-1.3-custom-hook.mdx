---

sidebar__label: '[Frontend] 1.3 - 測試 custom hook'
title: '[Frontend] 1.3 - 測試 custom hook'

---

## 問題

:::info Testing Custom Hook
在 React 16.8 後，我們有了 custom hook 這個新的概念，要如何測試呢？
:::

<br />


## 描述

在早期 React < v18 的時候，react-testing-library 還沒有測試 customHook 的 api， <br />
是藉由 [React Hooks Testing Library](https://react-hooks-testing-library.com/) 來測試 customHook

<br />

但是因為 React 18 有做了一些變更，使得 [React Hooks Testing Library](https://react-hooks-testing-library.com/) 無法使用， <br />
反而是將 solution 整合到 react-testing-library 了 (see [issue](https://github.com/testing-library/react-hooks-testing-library#details) )， <br />
因此，我們可以直接使用 React testing library 的 `renderHook` api 來做測試，兩者的用法一模一樣

<br />

用法會類似於 `useRef`，結果會存在 `.current` 的屬性裡

```jsx
// production code

const useUserLocations = () => {
	const [userLocations, setUserLocations] = useState();

	useEffect(() => {
		setUserLocations(['America', 'French']);
	}, []);
	
	return userLocations;
};
```

<br />

```jsx
// Testing code

describe('userLocations', () => {
	test('by default, should return an array containing users locations', () => {
		// Act
		const { result } = renderHook(useFetchUserLocation);

		// Assert
		expect(result.current).toEqual(['America', 'French']);
	});
});
```


<br /><br />


# 測試有起始 props 的 customHook

在 `renderHook` api ，我們可以傳入第二個參數，
第二個參數是一個 object，傳入一些基本的設定，
像是 `initialProps` 就可以在此帶入

```jsx
// production code

const useUserLocations = (props) => {
	const [userLocations, setUserLocations] = useState(props.userLocations);
	return userLocations;
};
```

<br />

```jsx
// Testing code

describe('userLocations', () => {
  test('by default, should return an array containing users locations', () => {
    // Arrange
    const userLocations = ['America', 'French'];

    // Act
    const { result } = renderHook(useFetchUserLocation, {
      initialProps: { userLocations },
    });

    // Assert
    expect(result.current).toEqual(['America', 'French']);
  });
});
```

<br />

## 結論

我們可以直接用 React Testing library 的 `renderHook` api 來做測試， <br />
其支援所有 React 的版本，即使是 React v18


<br />

## 參考文獻
> - [Testing Library - renderHook](https://testing-library.com/docs/react-testing-library/api/#renderhook)
