---
sidebar_label: '[Design Pattern] Chain of Responsibility pattern'
title: '[Design Pattern] Chain of Responsibility pattern'
tags:
  - Design Pattern

---


## ç‚ºä»€éº¼éœ€è¦è²¬ä»»éˆæ¨¡å¼ï¼Ÿ

<br />

> <p>ğŸ¥² å¸¸æœ‰æ–°éœ€æ±‚éœ€è¦å»æ›´æ”¹è™•ç†äº‹æƒ…çš„é †åº</p> 
> <p>âœ… æˆ‘å€‘å¯ä»¥ä¾ç…§éœ€æ±‚å¾ˆå½ˆæ€§çš„å»æ›´æ”¹ handlers çš„é †åº </p>

<br />

> <p>ğŸ¥² å¸¸æœ‰æ–°éœ€æ±‚éœ€è¦æ”¹åˆ°èˆŠæœ‰çš„ç¨‹å¼ç¢¼é‚è¼¯ï¼Œé€ æˆåŸæœ¬è™•ç†çš„é‚è¼¯è¶Šä¾†è¶Šå¤§åŒ…å’Œè¤‡é›œï¼Œé›£ä»¥ç¶­è­·</p>
> âœ… <b>å–®ä¸€è·è²¬åŸå‰‡ (Single Responsibility Principle)</b>ï¼š <br />
> ç•¶æœ‰æ–°éœ€æ±‚æ™‚ï¼Œä¸æœƒå»å‹•åˆ°è§¸ç™¼æ•´æ¢éˆçš„ Class / Object / Functionï¼Œè€Œæ˜¯å¯¦éš›åŸ·è¡Œæ¯é …ç´°ç¯€çš„ Class / Object / Function

<br />

> <p>ğŸ¥² å¸¸æœ‰æ–°éœ€æ±‚éœ€è¦æ”¹åˆ°èˆŠæœ‰çš„ç¨‹å¼ç¢¼é‚è¼¯ï¼Œé€ æˆåŸæœ¬è™•ç†çš„é‚è¼¯è¶Šä¾†è¶Šå¤§åŒ…å’Œè¤‡é›œï¼Œé›£ä»¥ç¶­è­·</p>
> âœ… <b>é–‹æ”¾å°é–‰åŸå‰‡ (Open/Closed Principle)</b>ï¼š <br />
> æˆ‘å€‘å¯ä»¥è¼•é¬†åœ°åŠ å…¥æ–°çš„ handlerï¼Œè€Œä¸éœ€è¦æ”¹åˆ°èˆŠæœ‰ Class / Object / Function

 
<br /><br />


## ä»€éº¼æ˜¯è²¬ä»»éˆæ¨¡å¼ï¼Ÿ
 

<img src="/img/chain-of-responsibility-illustration.png" alt="chain-of-responsibility" />

<br />

> <b>Chain of Responsibility</b> is a behavioral design pattern that lets you pass requests along a chain of handlers. Upon receiving a request, each handler decides either to process the request or to pass it to the next handler in the chain

<br />

å°‡éœ€æ±‚å‚³é€åˆ°ä¸€ä¸²çš„è™•ç†ç¨‹åºï¼Œæ¯å€‹ç¨‹åºå¯ä»¥æ±ºå®šæ˜¯å¦è¦è™•ç†æˆ–å‚³åˆ°ä¸‹ä¸€å€‹éˆä¸­çš„è™•ç†ç¨‹åº

 

<br /><br />


### ç¾å¯¦ä¸­çš„æƒ…å¢ƒ
 

<img src="/img/chain-of-responsibility-in-reality.png" alt="chain-of-responsibility-in-reality" />
 

ä½ å‰›è²·ä¸¦å®‰è£äº†ä¸€å€‹æ–°çš„ç¡¬é«”åœ¨ä½ çš„é›»è…¦ä¸Šã€‚ç”±æ–¼ä½ æ˜¯å€‹æ¥µå®¢ï¼Œé›»è…¦ä¸Šå®‰è£äº†å¥½å¹¾å€‹æ“ä½œç³»çµ±ã€‚ä½ è©¦åœ–å•Ÿå‹•æ‰€æœ‰çš„æ“ä½œç³»çµ±ä»¥æŸ¥çœ‹ç¡¬é«”æ˜¯å¦è¢«æ”¯æŒã€‚Windows è‡ªå‹•æª¢æ¸¬ä¸¦å•Ÿç”¨ç¡¬é«”ã€‚ç„¶è€Œï¼Œä½ å¿ƒæ„›çš„ Linux æ‹’çµ•èˆ‡æ–°ç¡¬é«”é…åˆå·¥ä½œã€‚æ‡·è‘—ä¸€çµ²å¸Œæœ›ï¼Œä½ æ±ºå®šæ’¥æ‰“ç›’å­ä¸Šå¯«çš„æŠ€è¡“æ”¯æ´é›»è©±è™Ÿç¢¼ <br /><br />

ä½ é¦–å…ˆè½åˆ°çš„æ˜¯<b><u>è‡ªå‹•æ‡‰ç­”æ©Ÿå™¨äººçš„è²éŸ³</u></b>ã€‚å®ƒæå‡ºäº†ä¹å€‹é‡å°å„ç¨®å•é¡Œçš„ç†±é–€è§£æ±ºæ–¹æ¡ˆï¼Œä½†éƒ½èˆ‡ä½ çš„æƒ…æ³ç„¡é—œã€‚éäº†ä¸€æœƒå…’ï¼Œæ©Ÿå™¨äººå°‡ä½ è½‰æ¥åˆ°ä¸€å€‹çœŸäººå®¢æœ <br /><br />

ç„¶è€Œï¼Œå®¢æœä¹Ÿç„¡æ³•æå‡ºå…·é«”çš„å»ºè­°ã€‚ä»–ä¸åœåœ°å¼•ç”¨æ‰‹å†Šä¸­çš„é•·ç¯‡æ®µè½ï¼Œæ‹’çµ•è½å–ä½ çš„æ„è¦‹ã€‚ç•¶ä½ ç¬¬åæ¬¡è½åˆ° â€œä½ è©¦éæŠŠé›»è…¦é—œæ‰å†é–‹æ©Ÿå—ï¼Ÿâ€ é€™å¥è©±æ™‚ï¼Œä½ è¦æ±‚<b><u>è½‰æ¥åˆ°ä¸€å€‹çœŸæ­£çš„å·¥ç¨‹å¸«</u></b> <br /><br />

æœ€çµ‚ï¼Œå®¢æœå°‡ä½ çš„é›»è©±è½‰æ¥çµ¦äº†ä¸€ä½å·¥ç¨‹å¸«ï¼Œä»–å¤§æ¦‚åœ¨è¾¦å…¬æ¨“çš„é™°æš—åœ°ä¸‹å®¤è£¡çš„å­¤ç¨ä¼ºæœå™¨æˆ¿è£¡æ¸´æœ›è‘—èˆ‡äººèŠå¤©å·²ä¹…ã€‚é€™ä½å·¥ç¨‹å¸«å‘Šè¨´ä½ åˆ°å“ªè£¡ä¸‹è¼‰åˆé©çš„é©…å‹•ç¨‹å¼ä»¥åŠå¦‚ä½•åœ¨ Linux ä¸Šå®‰è£å®ƒå€‘ã€‚çµ‚æ–¼ï¼Œå•é¡Œè§£æ±ºäº†ï¼ä½ çµæŸäº†é€šè©±ï¼Œå¿ƒä¸­å……æ»¿å–œæ‚…

 
<br /><br />
 

### é–‹ç™¼ä¸­çš„æƒ…å¢ƒ
 
<img src="/img/chain-of-responsibility-in-development.png" alt="chain-of-responsibility-in-development" />

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨é–‹ç™¼ä¸€å€‹ç·šä¸Šè¨‚è³¼ç³»çµ±ã€‚ä½ å¸Œæœ›é™åˆ¶åªæœ‰å·²é©—è­‰çš„ç”¨æˆ¶æ‰èƒ½å‰µå»ºè¨‚å–®ã€‚æ­¤å¤–ï¼Œæ“æœ‰ç®¡ç†æ¬Šé™çš„ç”¨æˆ¶å¿…é ˆèƒ½å¤ å®Œå…¨è¨ªå•æ‰€æœ‰è¨‚å–®ã€‚

ç¶“éä¸€ç•ªè¦åŠƒå¾Œï¼Œä½ æ„è­˜åˆ°é€™äº›æª¢æŸ¥å¿…é ˆä¾æ¬¡é€²è¡Œã€‚æ‡‰ç”¨ç¨‹åºå¯ä»¥åœ¨æ¥æ”¶åˆ°åŒ…å«ç”¨æˆ¶æ†‘è­‰çš„è«‹æ±‚æ™‚å˜—è©¦å°ç”¨æˆ¶é€²è¡Œç³»çµ±é©—è­‰ã€‚ç„¶è€Œï¼Œå¦‚æœé‚£äº›æ†‘è­‰ä¸æ­£ç¢ºä¸”é©—è­‰å¤±æ•—ï¼Œé‚£éº¼å°±æ²’æœ‰ç†ç”±é€²è¡Œä»»ä½•å…¶ä»–æª¢æŸ¥

 
<br /><br />
 
<img src="/img/chain-of-responsibility-in-development-2.png" alt="chain-of-responsibility-in-development-2" />

åœ¨æ¥ä¸‹ä¾†çš„å¹¾å€‹æœˆè£¡ï¼Œä½ å¯¦æ–½äº†æ›´å¤šé€™äº›é †åºæª¢æŸ¥ã€‚

ä½ çš„å…¶ä¸­ä¸€ä½åŒäº‹å»ºè­°ï¼Œç›´æ¥å°‡åŸå§‹æ•¸æ“šå‚³éåˆ°è¨‚è³¼ç³»çµ±æ˜¯ä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œä½ æ·»åŠ äº†ä¸€å€‹é¡å¤–çš„é©—è­‰æ­¥é©Ÿä¾†æ¸…ç†è«‹æ±‚ä¸­çš„æ•¸æ“šã€‚

å¾Œä¾†ï¼Œæœ‰äººæ³¨æ„åˆ°ç³»çµ±å®¹æ˜“å—åˆ°æš´åŠ›ç ´è§£å¯†ç¢¼æ”»æ“Šã€‚ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œä½ è¿…é€Ÿæ·»åŠ äº†ä¸€å€‹æª¢æŸ¥ï¼Œéæ¿¾ä¾†è‡ªåŒä¸€ IP åœ°å€çš„å¤šæ¬¡å¤±æ•—è«‹æ±‚ã€‚

å¦ä¸€ä½åŒäº‹å»ºè­°ï¼Œå°æ–¼åŒ…å«ç›¸åŒæ•¸æ“šçš„é‡è¤‡è«‹æ±‚ï¼Œå¯ä»¥é€šéè¿”å›ç·©å­˜çš„çµæœä¾†åŠ å¿«ç³»çµ±é€Ÿåº¦ã€‚å› æ­¤ï¼Œä½ æ·»åŠ äº†å¦ä¸€å€‹æª¢æŸ¥ï¼Œåªæœ‰åœ¨æ²’æœ‰åˆé©çš„ç·©å­˜éŸ¿æ‡‰æ™‚ï¼Œè«‹æ±‚æ‰æœƒé€šéåˆ°ç³»çµ±

 

<br /><br />

é€™äº›æª¢æŸ¥çš„ä»£ç¢¼ï¼ŒåŸæœ¬å°±å·²ç¶“é¡¯å¾—å‡Œäº‚ï¼Œéš¨è‘—ä½ æ·»åŠ æ¯ä¸€å€‹æ–°åŠŸèƒ½ï¼Œè®Šå¾—è¶Šä¾†è¶Šè‡ƒè…«ã€‚æ”¹è®Šä¸€å€‹æª¢æŸ¥æœ‰æ™‚æœƒå½±éŸ¿åˆ°å…¶ä»–æª¢æŸ¥ã€‚æœ€ç³Ÿç³•çš„æ˜¯ï¼Œç•¶ä½ å˜—è©¦é‡ç”¨é€™äº›æª¢æŸ¥ä¾†ä¿è­·ç³»çµ±çš„å…¶ä»–çµ„ä»¶æ™‚ï¼Œä½ ä¸å¾—ä¸é‡è¤‡ä¸€äº›ä»£ç¢¼ï¼Œå› ç‚ºé‚£äº›çµ„ä»¶éœ€è¦éƒ¨åˆ†æª¢æŸ¥ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ã€‚


<br /><br />
ç³»çµ±è®Šå¾—éå¸¸é›£ä»¥ç†è§£ä¸”ç¶­è­·æˆæœ¬é«˜æ˜‚ã€‚ä½ èˆ‡é€™äº›ä»£ç¢¼å¥®é¬¥äº†ä¸€æ®µæ™‚é–“ï¼Œç›´åˆ°æœ‰ä¸€å¤©ä½ æ±ºå®šé‡æ§‹æ•´å€‹ç³»çµ±

 

<br /><br />

<img src="/img/chain-of-responsibility-in-development-3.png" alt="chain-of-responsibility-in-development-3" />

åƒè¨±å¤šå…¶ä»–è¡Œç‚ºè¨­è¨ˆæ¨¡å¼ä¸€æ¨£ï¼Œè²¬ä»»éˆæ¨¡å¼ä¾è³´æ–¼å°‡ç‰¹å®šè¡Œç‚ºè½‰åŒ–ç‚ºç¨ç«‹çš„å°è±¡ï¼Œç¨±ç‚ºè™•ç†ç¨‹åºã€‚

è©²æ¨¡å¼å»ºè­°å°‡é€™äº›è™•ç†ç¨‹åºéˆæ¥æˆä¸€å€‹éˆã€‚æ¯å€‹éˆæ¥çš„è™•ç†ç¨‹åºéƒ½æœ‰ä¸€å€‹å­—æ®µï¼Œç”¨æ–¼å­˜å„²å°éˆä¸­ä¸‹ä¸€å€‹è™•ç†ç¨‹åºçš„å¼•ç”¨ã€‚é™¤äº†è™•ç†è«‹æ±‚å¤–ï¼Œè™•ç†ç¨‹åºé‚„æœƒå°‡è«‹æ±‚é€²ä¸€æ­¥å‚³éä¸‹å»ã€‚è«‹æ±‚æ²¿è‘—éˆå‚³éï¼Œç›´åˆ°æ‰€æœ‰è™•ç†ç¨‹åºéƒ½æœ‰æ©Ÿæœƒè™•ç†å®ƒã€‚

é€™è£¡æ˜¯æœ€å¥½çš„éƒ¨åˆ†ï¼šè™•ç†ç¨‹åºå¯ä»¥æ±ºå®šä¸å†å°‡è«‹æ±‚å‚³éåˆ°éˆçš„ä¸‹ä¸€å€‹è™•ç†ç¨‹åºï¼Œå¾è€Œæœ‰æ•ˆåœ°åœæ­¢ä»»ä½•é€²ä¸€æ­¥çš„è™•ç†

 

<br /><br />

## æ—©æœŸçš„å¯¦ç¾æ–¹å¼

### ç¯„ä¾‹ & ç„¡è²¬ä»»éˆçš„å¯¦ç¾
 
å‡è¨­æˆ‘å€‘è² è²¬ä¸€å€‹è²©è³£æ‰‹æ©Ÿçš„é›»å•†ç¶²ç«™ï¼Œç¶“éåˆ†åˆ¥ç¹³äº¤ 500 å…ƒå®šé‡‘å’Œ 200 å…ƒå®šé‡‘çš„å…©è¼ªé å®šå¾Œ(è¨‚å–®å·²åœ¨æ­¤æ™‚ç”Ÿæˆ)ï¼Œç¾åœ¨å·²ç¶“åˆ°äº†æ­£å¼è³¼è²·çš„éšæ®µã€‚

- orderTypeï¼šè¡¨ç¤ºè¨‚å–®é¡å‹(å®šé‡‘ç”¨æˆ¶æˆ–ä¸€èˆ¬è³¼è²·ç”¨æˆ¶)
  - code çš„å€¼ç‚º 1 çš„æ™‚å€™æ˜¯ 500 å…ƒå®šé‡‘ç”¨æˆ¶
  - code çš„å€¼ç‚º 2 çš„æ™‚å€™æ˜¯ 200 å…ƒå®šé‡‘ç”¨æˆ¶
  - code çš„å€¼ç‚º 3 çš„æ™‚å€™æ˜¯æ™®é€šè³¼è²·ç”¨æˆ¶

- payï¼šè¡¨ç¤ºä½¿ç”¨è€…æ˜¯å¦å·²æ”¯ä»˜è¨‚é‡‘ï¼Œå€¼ç‚º true æˆ– falseï¼Œé›–ç„¶ä½¿ç”¨è€…å·²ç¶“ä¸‹é 500 å…ƒå®šé‡‘çš„è¨‚å–®ï¼Œä½†å¦‚æœä»–ä¸€ç›´æ²’æœ‰æ”¯ä»˜å®šé‡‘ï¼Œç¾åœ¨åªèƒ½é™ç´šé€²å…¥æ™®é€šè³¼è²·æ¨¡å¼ã€‚

- stockï¼šè¡¨ç¤ºç›®å‰ç”¨æ–¼æ™®é€šè³¼è²·çš„æ‰‹æ©Ÿåº«å­˜æ•¸é‡ï¼Œå·²ç¶“æ”¯ä»˜é 500 å…ƒæˆ– 200 å…ƒå®šé‡‘çš„ç”¨æˆ¶ä¸å—æ­¤é™åˆ¶ã€‚


<br />

```js
const order = function (orderType, pay, stock) {
  if (orderType === 1) {
    if (pay === true) {
      console.log('500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸');
    } else {
      if (stock > 0) {
        console.log('æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸');
      } else {
        console.log('æ‰‹æ©Ÿåº«å­˜ä¸è¶³');
      }
    }
  }

  else if (orderType === 2) {
    if (pay === true) {
      console.log('200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸');
    } else {
      if (stock > 0) {
        console.log('æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸');
      } else {
        console.log('æ‰‹æ©Ÿåº«å­˜ä¸è¶³');
      }
    }
  }

  else if (orderType === 3) {
    if (stock > 0) {
      console.log('æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸');
    } else {
      console.log('æ‰‹æ©Ÿåº«å­˜ä¸è¶³');
    }
  }
};

order(1, true, 500); // output: 500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸
order(1, false, 0); // output: æ‰‹æ©Ÿåº«å­˜ä¸è¶³
order(2, true, 500); // output: 200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸
order(3, false, 100); // output: æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸
```


<br /><br />

### ç„¡å½ˆæ€§çš„è²¬ä»»éˆå¯¦ç¾

æˆ‘å€‘å˜—è©¦ç”¨è²¬ä»»éˆæ¨¡å¼é‡æ§‹ç¨‹å¼ç¢¼


```js
const orderNormal = function (orderType, pay, stock) {
  if (stock > 0) {
    console.log('æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸');
  } else {
    console.log('æ‰‹æ©Ÿåº«å­˜ä¸è¶³');
  }
};

const order200 = function (orderType, pay, stock) {
  if (orderType === 2 && pay === true) {
    console.log('200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸');
  } else {
    orderNormal(orderType, pay, stock);
  }
};

const order500 = function (orderType, pay, stock) {
    if (orderType === 1 && pay === true) {
        console.log('500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸');
    } else {
        order200(orderType, pay, stock);
    }
};

order500( 1 , true, 500); // output: 500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸
order500( 1, false, 500 ); // output: æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸
order500( 2, true, 500 ); // output: 200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸
order500( 3, false, 500 ); // output: æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸
order500( 3, false, 0 ); // output: æ‰‹æ©Ÿåº«å­˜ä¸è¶³
```


<br /><br />

é€™ä¾ç„¶æ˜¯é•åé–‹æ”¾-å°é–‰åŸå‰‡çš„ï¼Œå¦‚æœæœ‰å¤©æˆ‘å€‘è¦å¢åŠ  300 å…ƒé è¨‚æˆ–å»æ‰ 200 å…ƒé è¨‚ï¼Œæ„å‘³è‘—å°±å¿…é ˆæ”¹å‹•é€™äº›æ¥­å‹™å‡½æ•¸å…§éƒ¨ã€‚å°±åƒä¸€æ¢ç’°ç’°ç›¸æ‰£æ‰“äº†æ­»çµçš„éˆæ¢ã€‚

<br /><br />

### éˆæ´»å¯æ‹†åˆ†çš„è²¬ä»»éˆå¯¦ç¾

```js
const order500 = function (orderType, pay, stock) {
  if (orderType === 1 && pay === true) {
    console.log('500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸');
  } else {
    return 'nextSuccessor';
  }
};

const order200 = function (orderType, pay, stock) {
  if (orderType === 2 && pay === true) {
    console.log('200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸');
  } else {
    return 'nextSuccessor';
  }
};

const orderNormal = function (orderType, pay, stock) {
  if (stock > 0) {
    console.log('æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸');
  } else {
    console.log('æ‰‹æ©Ÿåº«å­˜ä¸è¶³');
  }
};

class Chain {
  constructor(fn) {
    this.fn = fn;
    this.successor = null;
  }
  setNextSuccessor(successor) {
    this.successor = successor;
    return this.successor;
  }
  passRequest(...args) {
    const result = this.fn(...args);
    if (result === 'nextSuccessor') {
      return this.successor && this.successor.passRequest(...args);
    }
    return result;
  }
}

const chainOrder500 = new Chain(order500);
const chainOrder200 = new Chain(order200);
const chainOrderNormal = new Chain(orderNormal);

chainOrder500
  .setNextSuccessor(chainOrder200)
  .setNextSuccessor(chainOrderNormal);


chainOrder500.passRequest(1, true, 500); // output: 500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸
chainOrder500.passRequest(1, false, 0); // output: æ‰‹æ©Ÿåº«å­˜ä¸è¶³
chainOrder500.passRequest(2, true, 500); // output: 200 å…ƒè¨‚é‡‘é è³¼, å–å¾— 50 å„ªæƒ åˆ¸
chainOrder500.passRequest(3, false, 100); // output: æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸
chainOrder500.passRequest(3, false, 0); // output: æ‰‹æ©Ÿåº«å­˜ä¸è¶³
```


<br /><br />
é€éæ”¹é€²ï¼Œæˆ‘å€‘å¯ä»¥è‡ªç”±éˆæ´»åœ°å¢åŠ ã€ç§»é™¤å’Œä¿®æ”¹éˆä¸­çš„ç¯€é»é †åºï¼Œå‡å¦‚æŸå¤©ç¶²ç«™é‹ç‡Ÿäººå“¡åˆæƒ³å‡ºäº†æ”¯æŒ 300 å…ƒå®šé‡‘è³¼è²·ï¼Œé‚£æˆ‘å€‘å°±åœ¨è©²éˆä¸­å¢åŠ ä¸€å€‹ç¯€é»å³å¯

<br /><br />

```js
const order300 = function (orderType, pay, stock) {
  if (orderType === 4 && pay === true) {
    console.log('300 å…ƒè¨‚é‡‘é è³¼, å–å¾— 60 å„ªæƒ åˆ¸');
  } else {
    return 'nextSuccessor';
  }
};

const chainOrder500 = new Chain(order500);
const chainOrder300 = new Chain(order300);
const chainOrder200 = new Chain(order200);
const chainOrderNormal = new Chain(orderNormal);

chainOrder500
  .setNextSuccessor(chainOrder300)
  .setNextSuccessor(chainOrder200)
  .setNextSuccessor(chainOrderNormal);

chainOrder500.passRequest(4, true, 0); // output: 300 å…ƒè¨‚é‡‘é è³¼, å–å¾— 60 å„ªæƒ åˆ¸
```

### éåŒæ­¥å¯¦ç¾


```js
class Chain {
  constructor(fn) {
    this.fn = fn;
    this.successor = null;
  }
  setNextSuccessor(successor) {
    this.successor = successor;
    return this.successor;
  }
  passRequest(...args) {
    const result = this.fn(...args);
    if (result === 'nextSuccessor') {
      return this.successor && this.successor.passRequest(...args);
    }
    return result;
  }
  next(...args) {
    return this.successor && this.successor.passRequest(...args);
  }
}

const fn1 = new Chain(function () {
  console.log(1);
  return 'nextSuccessor';
});

const fn2 = new Chain(function () {
  console.log(2);
  var self = this;
  setTimeout(function () {
    self.next();
  }, 1000);
});

const fn3 = new Chain(function () {
  console.log(3);
});

fn1.setNextSuccessor(fn2).setNextSuccessor(fn3);
fn1.passRequest();
// 1
// 2
// ä¸€ç§’å¾Œå°å‡º 3
```

<br /><br />

## ç¾ä»£ JS è²¬ä»»éˆçš„å¯¦ç¾

### åŒæ­¥éˆçš„å¯¦ç¾ï¼šåˆ©ç”¨ ES6 Class
 

```js
class OrderManager {
  handle500Deposit() {
    if (orderType === 1 && pay === true) {
      throw '500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸';
    }
    return this;
  }

  handle200Deposit() {
    if (orderType === 2 && pay === true) {
      throw '500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸';
    }
    return this;
  }

  handleNormalOrder() {
    if (stock > 0) {
      return 'æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸';
    } else {
      return 'æ‰‹æ©Ÿåº«å­˜ä¸è¶³';
    }
  }

}

const orderManager = new OrderManager();

try {
  const normalMessage = orderManager
    .handle500Deposit()
    .handle200Deposit()
    .handleNormalOrder()
  console.log(normalMessage);
}

catch(couponMessage) {
  console.log(couponMessage);
}
```

<br /><br />

### éåŒæ­¥éˆçš„å¯¦ç¾ï¼šåˆ©ç”¨ ES6 Promise


```js
const handle500Deposit = async () => {
  if (orderType === 1 && pay === true) {
    throw '500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸';
  }
}

const handle200Deposit = async () => {
  if (orderType === 2 && pay === true) {
    throw '500 å…ƒè¨‚é‡‘é è³¼, å–å¾— 100 å„ªæƒ åˆ¸';
  }
  return this;
}

const handleNormalOrder = () => {
  if (stock > 0) {
    return 'æ™®é€šè³¼è²·, ç„¡å„ªæƒ åˆ¸';
  } else {
    return 'æ‰‹æ©Ÿåº«å­˜ä¸è¶³';
  }
}

handle500Deposit()
  .then(handle200Deposit)
  .then(handleNormalOrder)
  .then((normalMessage) => {
    console.log(normalMessage);
  })
  .catch((couponMessage) => {
      console.log(couponMessage);
  })
```

<br /><br />

## å¯¦éš›é–‹ç™¼ç¯„ä¾‹

### 1. å–å¾— CSV è³‡æ–™ï¼šè²¬ä»»éˆæ¨¡å¼


```jsx
import { useState } from 'react'
import './App.css'

function App() {
  const [csvData, setCsvData] = useState();
  const [fileError, setFileError] = useState();

  const checkIsCsv = async (e) => {
    const file = e.target.files[0];
    if (file.type !== 'text/csv') {
      throw new Error('File type error');
    }
    return file;
  }

  const readCsvFileText = (csvFile) => {
    const fileReader = new FileReader();
    fileReader.readAsText(csvFile);

    return new Promise((resolve) => {
      fileReader.onload = function(event) {
        const csvAllText = fileReader.result;
        resolve(csvAllText);
      };
    })
  }

  const storeCsvData = async (csvData) => {
    setCsvData(csvData);
    setFileError('');
  }

  const getCsvData = (e) => {
    checkIsCsv(e)
      .then(readCsvFileText)
      .then(storeCsvData)
      .catch((err) => {
        setCsvData('');
        setFileError(err.message);
      })
  }

  return (
    <>
      <input type="file" onChange={getCsvData} />
      {csvData && (
        <>
          <h2>Csv data</h2>
          <p>{csvData}</p>
        </>
      )}
      {fileError && (
        <p style={{ color: '#f00' }}>{fileError}</p>
      )}
    </>
  )
}

export default App
```

 


<br /><br />
 

### 2. å–å¾— CSV è³‡æ–™ & é©—è­‰ï¼šç­–ç•¥æ¨¡å¼ + è²¬ä»»éˆæ¨¡å¼

[Get & Validate CSV data](https://stackblitz.com/edit/vitejs-vite-xjzq5y?file=App.js)

 
```jsx
import { useState } from 'react'
import Papa from 'papaparse';
import './App.css'

const fileRulesMap = {
  isCsv: {
    test(file) {
      if (file.type !== 'text/csv') {
        return 'File type error';
      }
    }
  },
  isExcceedMax: {
    test(file) {
      if (file.size > 200) {
        return 'Excceed Max size';
      }
    }
  }
}

const recordRules = {
  isNameRequired: {
    test(record) {
      if (!record.name.length) {
        return 'Name is required'
      }
    }
  },
  isEmailRequired: {
    test(record) {
      if (!record.name.length) {
        return 'Email is required'
      }
    }
  }
}

function App() {
  const [csvData, setCsvData] = useState();
  const [fileError, setFileError] = useState();

  const checkIsCsv = async (e) => {
    const file = e.target.files[0];
    const fileRules = Object.values(fileRulesMap)

    const errors = fileRules.reduce((errors, fileRule) => {
      const error = fileRule.test(file);
      if (error) errors.push(error);
      return errors;
    }, [])

    if (errors.length > 0) {
      throw new Error(errors.join(','))
    }

    return file;
  }

  const readCsvFileText = (csvFile) => {
    const fileReader = new FileReader();
    fileReader.readAsText(csvFile);

    return new Promise((resolve) => {
      fileReader.onload = function(event) {
        const csvAllText = fileReader.result;
        resolve(csvAllText);
      };
    })
  }

  const storeCsvData = async (csvData) => {
    setCsvData(csvData);
    setFileError('');
	
    const parsedCsv = Papa.parse(csvData, { header: true });
    return parsedCsv;
  }

  const getCsvData = (e) => {
    checkIsCsv(e)
      .then(readCsvFileText)
      .then(storeCsvData)
      .catch((err) => {
        setCsvData('');
        setFileError(err.message);
      })
  }

  return (
    <>
      <input type="file" onChange={getCsvData} />
      {csvData && (
        <>
          <h2>Csv data</h2>
          <p>{csvData}</p>
        </>
      )}
      {fileError && (
        <p style={{ color: '#f00' }}>{fileError}</p>
      )}
    </>
  )
}
export default App
```

<br /><br />


## çµè«–
1. ç•¶æœ‰ä¸€ç³»åˆ—æ­¥é©Ÿéœ€è¦ä¾åºåŸ·è¡Œï¼Œä¸”æ¯å€‹æ­¥é©Ÿéƒ½æœ‰å¯èƒ½å¤±æ•—æ™‚ï¼Œä¸”åŸ·è¡Œé †åºè¦å¾ˆå½ˆæ€§çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨è²¬ä»»éˆæ¨¡å¼
2. å¯ä»¥åˆ©ç”¨ ES6 Class, Promise ä¾†ç°¡å–®å¯¦ç¾è²¬ä»»éˆæ¨¡å¼

<br /><br />

### åƒè€ƒè³‡æ–™
- [JavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjoqvv_goiJAxWvjK8BHUZCK3QQFnoECBcQAQ&url=https%3A%2F%2Fgithub.com%2Fmynane%2FPDF%2Fblob%2Fmaster%2FJavaScript%25E8%25AE%25BE%25E8%25AE%25A1%25E6%25A8%25A1%25E5%25BC%258F%25E4%25B8%258E%25E5%25BC%2580%25E5%258F%2591%25E5%25AE%259E%25E8%25B7%25B5.pdf&usg=AOvVaw2TtCMfHgrVvG0_CV9InyEz&opi=89978449)
- [Refactoring Guru - Chain of Responsibility](https://refactoring.guru/design-patterns/chain-of-responsibility)

<br /><br />