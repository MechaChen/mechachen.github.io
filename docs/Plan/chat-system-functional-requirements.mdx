---
sidebar_label: '[Chat System] Functional Requirements'
title: '[Chat System] Functional Requirements'
tags:
  - Chat System
  - Architecture
---


Please design a chat system like following video:

<video
    controls
    width="700px"
    src="https://github.com/user-attachments/assets/8316b8db-1616-4842-b5e2-182e083446c1"
    alt="Chat System Functional Requirements"
/>


&nbsp;

## Requirements

As the candidate, it is important to understand the functional (basic) requirements first.

Here are some questions we can ask the interviewer to clarify the requirements:

<table>
  <tr>
    <td>Candidate</td>
    <td>Interviewer</td>
  </tr>
  <tr>
    <td>
      <b>What are the core functionalities needed?</b>
    </td>
    <td>
      <ul>
        <li>Sending a message to a user.</li>
        <li>Getting user's chat room list.</li>
        <li>Receiving messages from a user.</li>
        <li>See one's chat history with a user.</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>
      <b>Is the message receiving real-time?</b>
    </td>
    <td>
      Yes, users should receive messages in real-time, as fast as possible without having to refresh the page
    </td>
  </tr>
  <tr>
    <td>
      <b>What kind of message formats should be supported?</b>
    </td>
    <td>
      Let's support formats text at first. We can discuss supporting emojis, images if there's time.
    </td>
  </tr>
  <tr>
    <td>
      <b>What kind of chat app shall we design? 1 on 1 or group based?</b>
    </td>
    <td>
      It should support both 1 on 1 and group chat.
    </td>
  </tr>
  <tr>
    <td>
      <b>Is there a message size limit?</b>
    </td>
    <td>
        Yes, text length should be less than 100,000 characters long.
    </td>
  </tr>
  <tr>
    <td>
      <b>How long shall we store the chat history?</b>
    </td>
    <td>
      Forever.
    </td>
  </tr>
</table>


<br />
<br />

## Architecture

<img src="/img/chat-system-architecture.png" alt="Chat System Architecture" />

### Component responsibilities

- Create room inputsï¼š
  - include select user dropdown menu, create room button to create a new chat room
- User's room list
  - show all the user's chat rooms, and able to select one to start chatting
- Chat room
  - show all the previous and real time messages between users
  - able to send message to current chat room

<br />

### Rendering approach

We will choose <b>CSR</b>, because it is high interactive and chat system's data should not be crawled by search engines.

<br />


## Data structure

Create room inputs:

```tsx
type User = {
    id: string,
    name: string,
    password: string,
}
```

<br />

User room lists

```tsx
type Room = {
    id: string,
    participants: User[],
    createdAt: Date,
}
```

<br />

Chat room

```tsx
type Message = {
    roomId: string,
    id: string,
    content: string,
    senderId: string,
    createdAt: Date,
    status: 'in-flight' | 'success' | 'failed',
}

type DraftMessage = {
    userIdAndRoomId: string,
    message: string,
    fileList?: File[],
}
```


<br />

## Interface



Chat room inputs:

```tsx
HTTP: 
- GET /users
(- POST /rooms) 
// there are 2 options, 
// 1. create room by HTTP request and get real time new room by SSE
// 2. create room and get real time new room list by WebSocket if with Serverless architecture

WebSocket:
- actions: create_room
```

<br />

User room lists:

```tsx
HTTP:
GET /rooms

WebSocket:
- listen actions: create_room

(SSE:
- listen actions: create_room
)
```

<br />

Chat room:

```tsx
HTTP:
- POST /rooms/:roomId/messages

WebSocket:
- actions:
    - create_connection
    - create_message
    - delete_connection
- listen actions:
    - create_message
```


