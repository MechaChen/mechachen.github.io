---
sidebar_position: 0
sidebar_label: '[Design Pattern] Flux pattern'
title: '[Design Pattern] Flux pattern'
tags:
  - Design Pattern

---


## ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦ Flux?

### å•é¡Œï¼šæ··äº‚çš„è³‡æ–™æµå‘

- åœ¨å‰ç«¯ä¸­ï¼Œæˆ‘å€‘å¸¸ç”¨çš„ MVC çš„æ¯å€‹éƒ¨åˆ†è³‡æ–™æµå‘éƒ½å¯ä»¥æ˜¯é›™å‘çš„ï¼Œè‹¥æ²’æœ‰è‰¯å¥½çš„æ…£ä¾‹æˆ–ç¶­è­·ï¼Œå°±æœƒé€ æˆè³‡æ–™æµé›£ä»¥æŒæ§ï¼Œå¾ŒçºŒå°ˆæ¡ˆé›£ä»¥ç¶­è­·

( æœ‰ç¶­è­·é jQuery å°ˆæ¡ˆçš„å°±çŸ¥é“ ğŸ¤ª )

<figure>
  <img src="/img/mvc.webp" width={500} />
  <figcaption>(åœ–ç‰‡ä¾†æºï¼šhttps://tw.alphacamp.co/blog/mvc-model-view-controller)</figcaption>
</figure>

<br />

<figure>
  <img src="/img/mvc-problem.png" width={500} />
  <figcaption>(åœ–ç‰‡ä¾†æºï¼šhttps://www.youtube.com/watch?v=nYkdrAPrdcw&list=PLb0IAmt7-GS188xDYE-u1ShQmFFGbrk0v&t=621s)</figcaption>
</figure>

<br /><br />

- æä¾›ä¸€å€‹å‰ç«¯çš„æ¦‚å¿µï¼Œè®“å¤§å®¶å¯ä»¥éµå¾ªï¼Œè®“å¤§è¦æ¨¡çš„é–‹ç™¼å’Œç¶­è­·ä¸Šä¸æœƒæœ‰ä¸çŸ¥é“è³‡æ–™æµå‘çš„å•é¡Œ


<br /><br />

## ä»€éº¼æ˜¯ Flux?

è®“ app data çš„æµå‘éµå¾ª Unidirectional data flowï¼Œä»¥è§£æ±º MVC æ²’æœ‰å®šç¾©è³‡æ–™æµå‘çš„ï¼Œé€ æˆç¶­è­·å›°é›£çš„å•é¡Œ

<figure>
  <img src="/img/flux-pattern.png" />
</figure>

<br /><br />

åŒæ™‚ä¸¦åœ¨

1. æ›´æ”¹ store state æ™‚ï¼Œä½¿ç”¨ Singleton ä¸”é™åˆ¶åªæœ‰ action èƒ½æ›´æ”¹ state
```mermaid
flowchart LR
subgraph Singleton pattern
direction LR
Action --> Dispatcher
Dispatcher --> Store
end
```

<br /><br />

2. æ›´æ–° View æ™‚ï¼Œåœ¨ Store state æ›´æ–°æ™‚åˆ©ç”¨ Observer é€šçŸ¥è¨‚é–±çš„ View
```mermaid
flowchart LR
subgraph Observer pattern
direction LR
Store --> View
end
```

<br /><br />

ä¾†é”æˆå–®ä¸€è³‡æ–™æµå‘ï¼Œä»¥ä¸‹å°±ä¾†ä¸€ä¸€èªªæ˜


<br /><br />

### **Singleton**: é™åˆ¶æ”¹è®Š store çš„ state çš„æ–¹æ³•

åˆ©ç”¨ store ä½œç‚ºæ•´å€‹ app çš„ Singleton Patternï¼Œç‚ºæ•´å€‹ app æ‰€æœ‰ç‹€æ…‹çš„é›†åˆé«” & å–®ä¸€å€‹å­˜åœ¨ï¼Œåªèƒ½é€é action å»æ”¹è®Š store çš„å€¼ï¼Œé™åˆ¶å…¶å­˜å–ï¼Œè®“æˆ‘å€‘å¯ä»¥é€éä¸€å€‹çµ±ä¸€çš„ state å€å¡Šå»ç¨®æ•´å€‹è³‡æ–™æµçš„æ›´æ–°

<br />

```js
// Actions
const actions = {
	increment: { type: 'INCREMENT' },
	decrement: { type: 'DECREMENT' },
};

// Reducer: manipulate store's state change
const countReducer = (state = initialState, action) => {
	switch (action.type) {
		case actions.increment.type:
			return { count: state.count + 1 };

		case actions.decrement.type:
			return { count: state.count - 1 };

		default:
			return state;
	}
}

// 
dispatch(actinos.increment);
store.getState() // { count: 1 }
```

<br /><br />

### Observer pattern: é€šçŸ¥æ‰€æœ‰çš„ viewï¼Œstore state æ”¹è®Šäº†

åœ¨ Redux çš„ç¨‹å¼åŸå§‹ç¢¼ä¸­ï¼Œå¯¦ç¾ `dispatch` çš„éƒ¨åˆ†ï¼Œç•¶åˆ©ç”¨ reducer è·Ÿ action ç”¢ç”Ÿæ–°çš„ store state æ™‚ï¼Œå°±æœƒé€šçŸ¥æ‰€æœ‰è¨»å†Šé€™å€‹ store çš„å°è±¡ï¼Œé€šå¸¸æ˜¯ä¸€å€‹ viewï¼Œæˆ–è€… React çš„ä¸€å€‹ Component ç­‰ï¼Œé€™ä¾¿æ˜¯åˆ©ç”¨çš„ Observer pattern çš„æ¦‚å¿µ

<br />

```js
const createStore = (myReducer) => {
	let listener = [];
	let currentState = myReducer(undefined, {});

	...

	const dispatch = (action) => {
		currentState = myReducer(currentState, action);

    // highlight-start
		listeners.forEach((listener) => {
			listener();
		});
    // highlight-end
	};

	return {
		getState,
		dispatch,
		subscribe,
	};
};
```

<br /><br />

## è£œå……: å·¥å» æ¨¡å¼ (Factory pattern) ä¾†ç”¢ç”Ÿå¤šå€‹å–®é«”(Singleton)

åœ¨ Redux ä¸­ï¼Œæ²’æœ‰é™åˆ¶åªèƒ½æ“æœ‰ä¸€å€‹ storeï¼Œåè€Œæä¾›äº†ä¸€å€‹ `createStore` çš„ apiï¼Œè®“æˆ‘å€‘å»å»ºç«‹è‡ªå·±çš„ storeï¼Œé€™ä¾¿æ˜¯ä½¿ç”¨äº† Factory pattern çš„æ¦‚å¿µ

Redux åˆ©ç”¨ function programming çš„ closure æŠ€å·§ï¼Œä¾†åƒ Class ä¸€æ¨£ä¿å­˜è‡ªå·±çš„ç‹€æ…‹ & è‡ªå·±çš„ listeners

<br />

```js
// highlight-start
const createStore = (myReducer) => {
	let listener = [];
	let currentState = myReducer(undefined, {});
// highlight-end

	const getState = () => {...};
	const dispatch = (action) => {...};
	const subscribe = (newListener) => {...};

	return {
		getState,
		dispatch,
		subscribe,
	};
};
```

<br /><br />

è®“æ¯å€‹ store éƒ½å¯ä»¥æ“æœ‰è‡ªå·±çš„ Component, view listenersï¼Œè‡ªå·±çš„ actionï¼Œä¸”æ¯å€‹ store éƒ½æ˜¯ç¨ç«‹çš„ï¼Œä¸æœƒäº’ç›¸å¹²æ“¾


<br /><br />


## çµè«–

1. MVC åªæ˜¯åš separation of concernï¼Œä½†æ˜¯ Flux é è‘—å°è³‡æ–™ä¾†æºçš„å­˜å–é™åˆ¶æ±ºå®šäº†è³‡æ–™çš„æµå‹•æ–¹å¼ï¼Œè®“æˆ‘å€‘æ›´å¯ä»¥æ¸…æ¥šåœ°äº†è§£è³‡æ–™çš„æµå‘ï¼Œè®“å°ˆæ¡ˆåœ¨ scaling æ™‚æ›´å¥½ç¶­è­·
2. å° Singelton çš„ store state åšå­˜å–çš„é™åˆ¶ï¼Œåªèƒ½ç”¨ action æ”¹è®Šï¼Œé”æˆè³‡æ–™å–®ä¸€æµå‘çš„ç›®çš„
3. åˆ©ç”¨ Obeserver pattern çš„æ¦‚å¿µï¼Œè®“ store é€šçŸ¥æ‰€æœ‰çš„ Viewï¼Œé€šçŸ¥æ‰€æœ‰è¨»å†Šçš„ React component


<br /><br />


### åƒè€ƒè³‡æ–™

- [The Mental Model That Helped Me Finally Understand "Flux" - Andy Ray's Blog (andrewray.me)](https://andrewray.me/blog/the-mental-model-that-helped-me-finally-understand-flux)
- [A cartoon guide to Flux. Flux is both one of the most popularâ€¦ | by Lin Clark | Code Cartoons | Medium](https://medium.com/code-cartoons/a-cartoon-guide-to-flux-6157355ab207)
- [Hacker Way: Rethinking Web App Development at Facebook - YouTube](https://www.youtube.com/watch?v=nYkdrAPrdcw&list=PLb0IAmt7-GS188xDYE-u1ShQmFFGbrk0v&t=621s)
- [Flux ç°¡å–®ç¯„ä¾‹ç¨‹å¼ (openai.com)](https://chat.openai.com/c/4ccb1384-4d32-410f-bbc9-71295c7bbde7)
- [How to Use Flux to Manage State in ReactJS - Explained with an Example (freecodecamp.org)](https://www.freecodecamp.org/news/how-to-use-flux-in-react-example/)
- [MVCæ¶æ§‹æ˜¯ä»€éº¼ï¼Ÿèªè­˜ Model-View-Controller è»Ÿé«”è¨­è¨ˆæ¨¡å¼ - ALPHA Camp](https://tw.alphacamp.co/blog/mvc-model-view-controller)

<br /><br />