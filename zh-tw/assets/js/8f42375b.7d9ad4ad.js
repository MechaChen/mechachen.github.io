"use strict";(self.webpackChunkbenson_doc=self.webpackChunkbenson_doc||[]).push([[9566],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(n),k=i,u=m["".concat(s,".").concat(k)]||m[k]||d[k]||l;return n?a.createElement(u,r(r({ref:t},c),{},{components:n})):a.createElement(u,r({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,r=new Array(l);r[0]=k;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:i,r[1]=o;for(var p=2;p<l;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},8746:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const l={sidebar_position:2.1,sidebar_label:"[Google Docs] Architecture - Conflict Resolution",title:"[Google Docs] Architecture - Conflict Resolution",tags:["System Design","Conflict Resolution"]},r=void 0,o={unversionedId:"Plan/google-doc-system-architecture-conflict-resolution",id:"Plan/google-doc-system-architecture-conflict-resolution",title:"[Google Docs] Architecture - Conflict Resolution",description:"Why Conflict Resolution matters in collaborative editing?",source:"@site/docs/Plan/google-doc-system-architecture-conflict-resolution.mdx",sourceDirName:"Plan",slug:"/Plan/google-doc-system-architecture-conflict-resolution",permalink:"/zh-tw/docs/Plan/google-doc-system-architecture-conflict-resolution",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Plan/google-doc-system-architecture-conflict-resolution.mdx",tags:[{label:"System Design",permalink:"/zh-tw/docs/tags/system-design"},{label:"Conflict Resolution",permalink:"/zh-tw/docs/tags/conflict-resolution"}],version:"current",lastUpdatedAt:1748307642,formattedLastUpdatedAt:"2025\u5e745\u670827\u65e5",sidebarPosition:2.1,frontMatter:{sidebar_position:2.1,sidebar_label:"[Google Docs] Architecture - Conflict Resolution",title:"[Google Docs] Architecture - Conflict Resolution",tags:["System Design","Conflict Resolution"]},sidebar:"tutorialSidebar",previous:{title:"[Google Docs] Requirements",permalink:"/zh-tw/docs/Plan/google-doc-system-requirements"},next:{title:"[Google Docs] Optimization - Undo/Redo",permalink:"/zh-tw/docs/Plan/google-doc-system-optimization-undo-redo"}},s={},p=[{value:"Why Conflict Resolution matters in collaborative editing?",id:"why-conflict-resolution-matters-in-collaborative-editing",level:2},{value:"Scenario 1: Alice changes applied first",id:"scenario-1-alice-changes-applied-first",level:3},{value:"Scenario 2: Bob changes applied first",id:"scenario-2-bob-changes-applied-first",level:3},{value:"Who is using OT &amp; CRDT?",id:"who-is-using-ot--crdt",level:2},{value:"Operational Transformation (OT)",id:"operational-transformation-ot",level:2},{value:"How it works?",id:"how-it-works",level:3},{value:"Scenario 1: Alice changes applied first",id:"scenario-1-alice-changes-applied-first-1",level:3},{value:"Scenario 2: Bob changes applied first",id:"scenario-2-bob-changes-applied-first-1",level:3},{value:"Pros and Cons",id:"pros-and-cons",level:3},{value:"Conflict Resolution Data Structure (CRDT)",id:"conflict-resolution-data-structure-crdt",level:2},{value:"What is CRDT?",id:"what-is-crdt",level:3},{value:"How it works?",id:"how-it-works-1",level:3},{value:"Case 1 : 2 users with different User ID",id:"case-1--2-users-with-different-user-id",level:3},{value:"Case 2 : 1st user with 2 characters, and 2nd user insert with 1 character at the same position",id:"case-2--1st-user-with-2-characters-and-2nd-user-insert-with-1-character-at-the-same-position",level:3},{value:"Case 3 : 3 users with different User ID and different timestamp",id:"case-3--3-users-with-different-user-id-and-different-timestamp",level:3},{value:"Scalability &amp; Performance",id:"scalability--performance",level:3},{value:"1. Group characters to save Memory",id:"1-group-characters-to-save-memory",level:4},{value:"2. Delete children object when parent is marked as deleted",id:"2-delete-children-object-when-parent-is-marked-as-deleted",level:4},{value:"Previous Alice &amp; Bob&#39;s example",id:"previous-alice--bobs-example",level:3},{value:"Pros and Cons",id:"pros-and-cons-1",level:3},{value:"Comparison",id:"comparison",level:2},{value:"Technical Comparison",id:"technical-comparison",level:3},{value:"Operational Transformation (OT)",id:"operational-transformation-ot-1",level:4},{value:"Conclusion : Which one to use?",id:"conclusion--which-one-to-use",level:2},{value:"References",id:"references",level:2}],c={toc:p},m="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"why-conflict-resolution-matters-in-collaborative-editing"},"Why Conflict Resolution matters in collaborative editing?"),(0,i.kt)("p",null,"Imagine Alice and Bob are editing the same document at the same time."),(0,i.kt)("p",null,"Original document: ",(0,i.kt)("inlineCode",{parentName:"p"},"ABCDE")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Alice deletes ",(0,i.kt)("inlineCode",{parentName:"li"},"D")),(0,i.kt)("li",{parentName:"ul"},"Bob deletes ",(0,i.kt)("inlineCode",{parentName:"li"},"B"))),(0,i.kt)("p",null,"As our expected, the client and server should handle the conflict correctly to ",(0,i.kt)("inlineCode",{parentName:"p"},"ACE"),"."),(0,i.kt)("p",null,"But network latency is unpredictable, there might be 2 scenarios:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Alice's operation is applied first"),(0,i.kt)("li",{parentName:"ol"},"Bob's operation is applied first")),(0,i.kt)("br",null),(0,i.kt)("img",{src:"/img/editing-conflict.png",alt:"Editing Conflict"}),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"scenario-1-alice-changes-applied-first"},"Scenario 1: Alice changes applied first"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Server receives Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE"),",\nand server passed the ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03")," to both Alice and Bob.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive own operation: no change"),(0,i.kt)("li",{parentName:"ol"},"Bob receive Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", and Bob's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACD")," \u26a0\ufe0f"))),(0,i.kt)("li",{parentName:"ol"},"Server receives Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and Alice's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")),(0,i.kt)("li",{parentName:"ol"},"Bob receive own operation: no change")))),(0,i.kt)("h3",{id:"scenario-2-bob-changes-applied-first"},"Scenario 2: Bob changes applied first"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Server receives Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE"),",\nand server passed the ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01")," to both Alice and Bob.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and Alice's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")),(0,i.kt)("li",{parentName:"ol"},"Bob receive own operation: no change"))),(0,i.kt)("li",{parentName:"ol"},"Server receives Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACD")," \u26a0\ufe0f",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive own operation: no change"),(0,i.kt)("li",{parentName:"ol"},"Bob receive Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", and Bob's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACD")," \u26a0\ufe0f")))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("p",null,"The result due to Alice or Bob changes applied first is different, that's not what we want."),(0,i.kt)("p",null,"Therefore, we need ",(0,i.kt)("strong",{parentName:"p"},"Conflict Resolution")," mechanism to handle the conflict correctly."),(0,i.kt)("p",null,"And there are 2 main approaches to handle the conflict:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Operational Transformation (OT)"),(0,i.kt)("li",{parentName:"ol"},"Conflict Resolution Data Structure (CRDT)")),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"who-is-using-ot--crdt"},"Who is using OT & CRDT?"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Technology"),(0,i.kt)("th",{parentName:"tr",align:null},"Product / Company"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"OT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("li",null,"Google Docs"),(0,i.kt)("li",null,"Etherpad"),(0,i.kt)("li",null,"Apache Wave"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"CRDT"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("li",null,(0,i.kt)("a",{parentName:"td",href:"https://www.figma.com/blog/how-figmas-multiplayer-technology-works/"},"Figma")),(0,i.kt)("li",null,"Yjs"),(0,i.kt)("li",null,(0,i.kt)("a",{parentName:"td",href:"https://evernote.com/blog/future-proofing-evernotes-foundations"},"Evernote")),(0,i.kt)("li",null,(0,i.kt)("a",{parentName:"td",href:"https://zed.dev/blog/crdts"},"Zed")))))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"operational-transformation-ot"},"Operational Transformation (OT)"),(0,i.kt)("p",null,"Operational Transformation (OT) is a conflict resolution technique that transforms user's operations to maintain consistency while preserving user intentions."),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"how-it-works"},"How it works?"),(0,i.kt)("p",null,"The Server utilizes OT and according to user's current state and intention, transforms operations to make all users state consistent and correct."),(0,i.kt)("br",null),(0,i.kt)("p",null,"Follow by the Alice's and Bob's example:"),(0,i.kt)("img",{src:"/img/editing-conflict-resolution.png",alt:"Editing Conflict Resolution OT"}),(0,i.kt)("h3",{id:"scenario-1-alice-changes-applied-first-1"},"Scenario 1: Alice changes applied first"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Server receives Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE"),",\nand server passed the ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03")," to both Alice and Bob.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive own operation: no change"),(0,i.kt)("li",{parentName:"ol"},"Before sending to Bob, server transforms Alice's operation to ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 02"),(0,i.kt)("br",null),"\nBob receive Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 02"),", and Bob's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")," \u2705"))),(0,i.kt)("li",{parentName:"ol"},"Server receives Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and Alice's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")),(0,i.kt)("li",{parentName:"ol"},"Bob receive own operation: no change")))),(0,i.kt)("h3",{id:"scenario-2-bob-changes-applied-first-1"},"Scenario 2: Bob changes applied first"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Server receives Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and server's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE"),",\nand server passed the ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01")," to both Alice and Bob.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive Bob's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 01"),", and Alice's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ABCE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")),(0,i.kt)("li",{parentName:"ol"},"Bob receive own operation: no change"))),(0,i.kt)("li",{parentName:"ol"},"Server receives Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03"),", before updating Server's state,\nserver transforms Alice's operation to ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 03")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 02"),", and update Server's state to ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")," \u2705",(0,i.kt)("br",null),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Alice receive own operation: no change"),(0,i.kt)("li",{parentName:"ol"},"Bob receive Alice's operation: ",(0,i.kt)("inlineCode",{parentName:"li"},"DEL 02"),", and Bob's state ",(0,i.kt)("inlineCode",{parentName:"li"},"ACDE")," -> ",(0,i.kt)("inlineCode",{parentName:"li"},"ACE")," \u2705")))),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"pros-and-cons"},"Pros and Cons"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Features"),(0,i.kt)("th",{parentName:"tr",align:"center"},"OT"),(0,i.kt)("th",{parentName:"tr",align:"center"},"CRDT"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Consistency"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Memory Usage"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705 (Low)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c (High)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"User Intent Preservation"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Implementation Effort"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c (Complex)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705 (Simple)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Peer-to-Peer Support"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"conflict-resolution-data-structure-crdt"},"Conflict Resolution Data Structure (CRDT)"),(0,i.kt)("h3",{id:"what-is-crdt"},"What is CRDT?"),(0,i.kt)("p",null,"Conflict Resolution Data Structure (CRDT) is a data structure that handle concurrent operations automatically, and all users' states converge to the same final state."),(0,i.kt)("br",null),(0,i.kt)("p",null,"We'll use ",(0,i.kt)("a",{parentName:"p",href:"https://yjs.dev/"},"Yjs")," as our CRDT example."),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"how-it-works-1"},"How it works?"),(0,i.kt)("p",null,"For Yjs, it will create an CRDT object for each operation, which includes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"user id"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Lamport_timestamp"},"Lamport timestamp"))),(0,i.kt)("p",null,"Which is used to decide which operation will show first."),(0,i.kt)("br",null),(0,i.kt)("p",null,"To decide which operation will show first, Yjs will use the following rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If the user id is the same, the operation with the smaller timestamp will be shown first."),(0,i.kt)("li",{parentName:"ul"},"If the user id is different, the operation with the smaller user id will be shown first.")),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"case-1--2-users-with-different-user-id"},"Case 1 : 2 users with different User ID"),(0,i.kt)("img",{width:"400",src:"/img/how-yjs-work.png",alt:"How Yjs works"}),(0,i.kt)("br",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Alice insert ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," at 0 position"),(0,i.kt)("li",{parentName:"ul"},"Bob insert ",(0,i.kt)("inlineCode",{parentName:"li"},"B")," at 0 position")),(0,i.kt)("br",null),(0,i.kt)("p",null,"Result: ",(0,i.kt)("inlineCode",{parentName:"p"},"AB")),(0,i.kt)("p",null,"Since Alice's user id is 0, which is smaller than Bob's user id 1, A will be shown first."),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"case-2--1st-user-with-2-characters-and-2nd-user-insert-with-1-character-at-the-same-position"},"Case 2 : 1st user with 2 characters, and 2nd user insert with 1 character at the same position"),(0,i.kt)("img",{width:"500",src:"/img/yjs-case-2.png",alt:"Yjs Case 2"}),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Alice (user ID : 0) insert ",(0,i.kt)("inlineCode",{parentName:"li"},"C")," between ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"B")),(0,i.kt)("li",{parentName:"ul"},"Alice (user ID : 0) insert ",(0,i.kt)("inlineCode",{parentName:"li"},"D")," between ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"B")),(0,i.kt)("li",{parentName:"ul"},"Bob (user ID : 1) insert ",(0,i.kt)("inlineCode",{parentName:"li"},"E")," between ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"B"))),(0,i.kt)("br",null),(0,i.kt)("p",null,"Result: ",(0,i.kt)("inlineCode",{parentName:"p"},"ACDEB")),(0,i.kt)("p",null,"Process : "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Alice's user id is 0, insert ",(0,i.kt)("inlineCode",{parentName:"li"},"C")," operation will be shown first, ",(0,i.kt)("br",null)),(0,i.kt)("li",{parentName:"ol"},"Alice's insert ",(0,i.kt)("inlineCode",{parentName:"li"},"D")," operation will connect to ",(0,i.kt)("inlineCode",{parentName:"li"},"C")," operation as Linked List, so it will be shown right after ",(0,i.kt)("inlineCode",{parentName:"li"},"C")," ",(0,i.kt)("br",null)),(0,i.kt)("li",{parentName:"ol"},"Bob's insert ",(0,i.kt)("inlineCode",{parentName:"li"},"E")," operation will be shown last, because it's the last operation. ",(0,i.kt)("br",null))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"case-3--3-users-with-different-user-id-and-different-timestamp"},"Case 3 : 3 users with different User ID and different timestamp"),(0,i.kt)("img",{width:"100%",src:"/img/yjs-complex-scenario.png",alt:"Yjs Complex Scenario"}),(0,i.kt)("br",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Alice insert ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," at 0 position at 0ms"),(0,i.kt)("li",{parentName:"ul"},"Bob insert ",(0,i.kt)("inlineCode",{parentName:"li"},"B")," at 0 position at 10ms"),(0,i.kt)("li",{parentName:"ul"},"Claire insert ",(0,i.kt)("inlineCode",{parentName:"li"},"C")," at 0 position at 20ms")),(0,i.kt)("br",null),(0,i.kt)("p",null,"Result: ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC")),(0,i.kt)("p",null,"Process : "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Since Alice's user id is 0, which is smaller than Bob's user id 1, A will be shown first. ",(0,i.kt)("br",null)),(0,i.kt)("li",{parentName:"ol"},"Bob's insert ",(0,i.kt)("inlineCode",{parentName:"li"},"B")," at 0 position at 10ms, which is greater than Alice's insert ",(0,i.kt)("inlineCode",{parentName:"li"},"A")," at 0 position at 0ms, B will be shown second. ",(0,i.kt)("br",null)),(0,i.kt)("li",{parentName:"ol"},"Finally, even Claire's user id is -1, which is smaller than Alice's & Bob's user id, but the timestamp is 20ms, which makes C's Lamport timestamp is greater than A & B's timestamp, C will be shown last.")),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"scalability--performance"},"Scalability & Performance"),(0,i.kt)("p",null,"Due to solving the conflict, Yjs will create lots of CRDT objects, which will consume lots of memory."),(0,i.kt)("p",null,"Therefore, Yjs have some strategies to save memory:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Group characters to save Memory"),(0,i.kt)("li",{parentName:"ol"},"Delete children object when parent is marked as deleted")),(0,i.kt)("br",null),(0,i.kt)("h4",{id:"1-group-characters-to-save-memory"},"1. Group characters to save Memory"),(0,i.kt)("img",{src:"/img/yjs-save-memory-by-collection.png",alt:"Yjs Save Memory by Collection"}),(0,i.kt)("p",null,"If we directly copy paste the entire sentence (like ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC"),"), it will combine together as one CRDT object."),(0,i.kt)("p",null,"For example, Yjs will create ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC")," object with following properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"userID")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"timestamp")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"length"),": 3")),(0,i.kt)("p",null,"which lead to ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC")," (0,0,3)"),(0,i.kt)("br",null),(0,i.kt)("p",null,"But if we insert D between B and C, the ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC")," object will be split into 2 objects: ",(0,i.kt)("inlineCode",{parentName:"p"},"AB")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"C"),"."),(0,i.kt)("p",null,"For example, Yjs will create ",(0,i.kt)("inlineCode",{parentName:"p"},"AB")," object with following properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"userID")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"timestamp")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"length"),": 2")),(0,i.kt)("p",null,"And ",(0,i.kt)("inlineCode",{parentName:"p"},"C")," object with following properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"userID")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"timestamp")," : 0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"length"),": 1")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"AB")," (0,0,2)\n",(0,i.kt)("inlineCode",{parentName:"p"},"C")," (0,0,1)"),(0,i.kt)("br",null),(0,i.kt)("h4",{id:"2-delete-children-object-when-parent-is-marked-as-deleted"},"2. Delete children object when parent is marked as deleted"),(0,i.kt)("img",{src:"/img/yjs-save-memory-by-remove-children.png",alt:"Yjs Save Memory by Remove Children"}),(0,i.kt)("p",null,"There is another way to save memory, which is delete children object when parent is marked as deleted."),(0,i.kt)("p",null,"In Yjs, CRDT object cannot be directly deleted, because we need to keep the position to make sure other operations execute on that CRDT object can be handled correctly, but we can mark it as deleted."),(0,i.kt)("p",null,"For example, if there is an paragraph, which contains ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"XY"),", when we mark paragraph as deleted, the ",(0,i.kt)("inlineCode",{parentName:"p"},"ABC")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"XY")," will be deleted."),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"previous-alice--bobs-example"},"Previous Alice & Bob's example"),(0,i.kt)("img",{width:"100%",src:"/img/yjs-alice-bob-example.png",alt:"Yjs Alice & Bob Example"}),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("p",null,"Since Alice's and Bob's insert operation are at different position, for CRDT, each operation can find the correct position to insert the character."),(0,i.kt)("p",null,"Which will lead to ",(0,i.kt)("inlineCode",{parentName:"p"},"ACE")),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h3",{id:"pros-and-cons-1"},"Pros and Cons"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Features"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Rating"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Consistency"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Memory Usage"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c (High)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"User Intent Preservation"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Implementation Effort"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705 (Simple)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Peer-to-Peer Support"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"comparison"},"Comparison"),(0,i.kt)("h3",{id:"technical-comparison"},"Technical Comparison"),(0,i.kt)("h4",{id:"operational-transformation-ot-1"},"Operational Transformation (OT)"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Features"),(0,i.kt)("th",{parentName:"tr",align:"center"},"OT"),(0,i.kt)("th",{parentName:"tr",align:"center"},"CRDT"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Consistency"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Memory Usage"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705 (Low)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c (High)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"User Intent Preservation"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Implementation Effort"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c (Complex)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705 (Simple)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Peer-to-Peer Support"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u274c"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")))),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"conclusion--which-one-to-use"},"Conclusion : Which one to use?"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Requirements"),(0,i.kt)("th",{parentName:"tr",align:"center"},"OT"),(0,i.kt)("th",{parentName:"tr",align:"center"},"CRDT"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Quickly Iterate (like Figma)"),(0,i.kt)("td",{parentName:"tr",align:"center"}),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Scalability (low memory usage)"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Keep User Intent"),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705"),(0,i.kt)("td",{parentName:"tr",align:"center"})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Peer-to-Peer Support"),(0,i.kt)("td",{parentName:"tr",align:"center"}),(0,i.kt)("td",{parentName:"tr",align:"center"},"\u2705")))),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("h2",{id:"references"},"References"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"GreatFrontend - Google Docs"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://operational-transformation.github.io/"},"Visualization of OT with a central server")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=aVTOKGLFuLo&list=PLASRuhw5l8pkZYv-IU7VjrQZgKOfRWD_0&index=2"},"Youtube - A Deep Dive into Yjs part 1")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Operational_transformation#Critique_of_OT"},"Wikipedia - Operational transformation")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type#Industry_use"},"Wikipedia - Conflict-free replicated data type")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Lamport_timestamp"},"Wikipedia - Lamport timestamp")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://evernote.com/blog/future-proofing-evernotes-foundations"},"Evernote - Future-Proofing Evernote's Foundations")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://zed.dev/blog/crdts"},"Zed - CRDTs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.figma.com/blog/how-figmas-multiplayer-technology-works/"},"Figma - How Figma's Multiplayer Technology Works")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://lars.hupel.info/topics/crdt/01-intro/"},"An introduction to Conflict-Free Replicated Data Types"))),(0,i.kt)("br",null))}d.isMDXComponent=!0}}]);