"use strict";(self.webpackChunkbenson_doc=self.webpackChunkbenson_doc||[]).push([[4179],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var l=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,r=function(e,t){if(null==e)return{};var n,l,r={},i=Object.keys(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)n=i[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=l.createContext({}),u=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=u(e.components);return l.createElement(s.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},c=l.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=u(n),c=r,h=m["".concat(s,".").concat(c)]||m[c]||p[c]||i;return n?l.createElement(h,a(a({ref:t},d),{},{components:n})):l.createElement(h,a({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,a[1]=o;for(var u=2;u<i;u++)a[u]=n[u];return l.createElement.apply(null,a)}return l.createElement.apply(null,n)}c.displayName="MDXCreateElement"},200:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var l=n(7462),r=(n(7294),n(3905));const i={sidebar_label:"[Implement] 100 \u884c\u5be6\u73fe React Virtualized",title:"[Implement] 100 \u884c\u5be6\u73fe React Virtualized",tags:["Implement","React","Virtualized"]},a=void 0,o={unversionedId:"Plan/implement-react-virtualized",id:"Plan/implement-react-virtualized",title:"[Implement] 100 \u884c\u5be6\u73fe React Virtualized",description:"https://github.com/MechaChen/react-virtualize-lite",source:"@site/docs/Plan/implement-react-virtualized.mdx",sourceDirName:"Plan",slug:"/Plan/implement-react-virtualized",permalink:"/zh-tw/docs/Plan/implement-react-virtualized",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Plan/implement-react-virtualized.mdx",tags:[{label:"Implement",permalink:"/zh-tw/docs/tags/implement"},{label:"React",permalink:"/zh-tw/docs/tags/react"},{label:"Virtualized",permalink:"/zh-tw/docs/tags/virtualized"}],version:"current",lastUpdatedAt:1733672195,formattedLastUpdatedAt:"2024\u5e7412\u67088\u65e5",frontMatter:{sidebar_label:"[Implement] 100 \u884c\u5be6\u73fe React Virtualized",title:"[Implement] 100 \u884c\u5be6\u73fe React Virtualized",tags:["Implement","React","Virtualized"]},sidebar:"tutorialSidebar",previous:{title:"[Implement] 40 \u884c\u5be6\u73fe React `useState`, `useEffect`",permalink:"/zh-tw/docs/Plan/implement-react-usestate-useeffect"},next:{title:"[Implement] 34 \u884c\u5be6\u73fe Redux",permalink:"/zh-tw/docs/Plan/implement-redux"}},s={},u=[{value:"\u70ba\u4ec0\u9ebc\u9700\u8981 Virtualized\uff1f",id:"\u70ba\u4ec0\u9ebc\u9700\u8981-virtualized",level:2},{value:"Virtualize \u7684\u5be6\u4f5c\u6982\u5ff5",id:"virtualize-\u7684\u5be6\u4f5c\u6982\u5ff5",level:2},{value:"1. \u8a08\u7b97 start, end \u5143\u7d20\u7684\u4f4d\u7f6e",id:"1-\u8a08\u7b97-start-end-\u5143\u7d20\u7684\u4f4d\u7f6e",level:3},{value:"2. \u6d41\u66a2\u5730\u6efe\u52d5",id:"2-\u6d41\u66a2\u5730\u6efe\u52d5",level:3},{value:"3. \u52a0\u4e0a\u524d\u5f8c preload \u7684\u5143\u7d20",id:"3-\u52a0\u4e0a\u524d\u5f8c-preload-\u7684\u5143\u7d20",level:3},{value:"\u512a\u5316",id:"\u512a\u5316",level:2},{value:"CSS <code>transform</code>",id:"css-transform",level:3},{value:"\u7d50\u8ad6",id:"\u7d50\u8ad6",level:2},{value:"\u53c3\u8003\u8cc7\u6599",id:"\u53c3\u8003\u8cc7\u6599",level:3}],d={toc:u},m="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,l.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"\u539f\u59cb\u78bc\u5728\u9019\uff0c\u6b61\u8fce\u53c3\u8003\uff5e",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/MechaChen/react-virtualize-lite"},"https://github.com/MechaChen/react-virtualize-lite"))),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"\u70ba\u4ec0\u9ebc\u9700\u8981-virtualized"},"\u70ba\u4ec0\u9ebc\u9700\u8981 Virtualized\uff1f"),(0,r.kt)("p",null,"\u5c0d\u65bc\u4e00\u500b\u8d85\u7d1a\u9577\u7684\u5217\u8868\u4f86\u8aaa\uff0c\u6709\u53ef\u80fd\u9020\u6210\u6e32\u67d3\u6642\u4e0a\u7684\u6548\u80fd\u554f\u984c\uff0c\u4f8b\u5982"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6ed1\u52d5\u7684\u592a\u5feb\u6642\uff0c\u6703\u6709\u77ed\u6642\u9593\u7684\u767d\u756b\u9762 (\u6b64\u7bc4\u4f8b\u7d04 100,000 \u500b\u5143\u7d20\u6642\u6703\u6709\u6b64\u554f\u984c)"),(0,r.kt)("li",{parentName:"ul"},"\u8a18\u61b6\u9ad4\u4f7f\u7528\u91cf\u904e\u9ad8\uff0c\u8b93 browser \u76f4\u63a5 crash (\u6b64\u7bc4\u4f8b 1,000,000 \u500b\u5143\u7d20\u6642\u6703\u76f4\u63a5 crash)")),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/W9J4aH8B474?si=stEUK0vJgI6_hfd6",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u70ba\u4e86\u907f\u514d\u4e0a\u8ff0\u554f\u984c\uff0c\u6211\u5011\u53ef\u4ee5\u5229\u7528 Virtualized \u7684\u6280\u5de7\uff0c\u7522\u751f\u7684\u7d50\u679c\u5982\u4e0b\u5f71\u7247"),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/yX-lbiR9000?si=3g6kUAijx1isYGtr",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"Virtualized \u7684\u6982\u5ff5\u662f\uff0c\u53ea\u6e32\u67d3\u756b\u9762\u53ef\u898b\u7684\u5143\u7d20\uff0c\u9032\u800c\u512a\u5316\u6211\u5011\u7684\u6548\u80fd"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u6211\u5011\u5c31\u4f86\u7c21\u55ae\u5be6\u4f5c\u4e00\u500b react virtualized \u4f86\u4e86\u89e3\u80cc\u5f8c\u5982\u4f55\u904b\u4f5c\u7684\uff01"),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"virtualize-\u7684\u5be6\u4f5c\u6982\u5ff5"},"Virtualize \u7684\u5be6\u4f5c\u6982\u5ff5"),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u6211\u5011\u5148\u4f86\u770b\u770b\u9084\u6c92\u6709 Virtualized \u7684\u7a0b\u5f0f\u78bc\uff0c\u57fa\u672c\u4e0a\u5c31\u662f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6709\u4e00\u500b\u5217\u8868\uff0c\u6703\u6e32\u67d3 100,000 \u500b list item"),(0,r.kt)("li",{parentName:"ul"},"\u6574\u500b\u5217\u8868\u7684\u9ad8\u5ea6\u70ba 500px"),(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u500b list item \u7684\u9ad8\u5ea6\u70ba 35px"),(0,r.kt)("li",{parentName:"ul"},"\u6bcf\u500b list item \u7684\u80cc\u666f\u984f\u8272\u6703\u7070\u767d\u4ea4\u66ff")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'const itemHeight = 35; // Adjustable global variable\n\nconst ListItem = ({ index }) => {\n  return (\n    <li\n      className="text-center w-full leading-9"\n      style={{ backgroundColor: index % 2 === 0 ? \'#f0f0f0\' : \'white\' }}\n    >\n      List Item Index - {index}\n    </li>\n  );\n};\n\nexport const NonVirtualizedList = ({\n  numberOfItems,\n}) => {\n  const listItems = Array.from({ length: numberOfItems }, (_, index) => (\n    <ListItem key={index} index={index} />\n  ));\n\n  return (\n    <ul\n      className="overflow-y-scroll w-full h-[500px] border-2 border-black"\n      onScroll={(e) => {\n        console.log(\'Scrolling \', e.currentTarget.scrollTop);\n      }}\n    >\n      {listItems}\n    </ul>\n  );\n};\n\nexport const numberOfItems = 100000;\n\nexport default function NonVirtualized() {\n  return (\n    <div className="flex flex-col items-center justify-center h-[100vh]">\n      <h1 className="pb-4">Rendering {numberOfItems.toLocaleString()}</h1>\n      <NonVirtualizedList numberOfItems={numberOfItems} />\n    </div>\n  );\n}\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u6709\u4e86\u4e0a\u8ff0\u7684\u7a0b\u5f0f\u78bc\u5f8c\uff0c\u6211\u5011\u5c31\u4f86\u7528 Virtualized \u7684\u6280\u5de7\u4f86\u512a\u5316\u5b83\u5427\uff01"),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"1-\u8a08\u7b97-start-end-\u5143\u7d20\u7684\u4f4d\u7f6e"},"1. \u8a08\u7b97 start, end \u5143\u7d20\u7684\u4f4d\u7f6e"),(0,r.kt)("p",null,"\u9996\u5148\uff0c\u70ba\u4e86\u50c5\u986f\u793a\u51fa\u756b\u9762\u53ef\u898b\u7684\u5143\u7d20\uff0c\u6211\u5011\u6709 4 \u4ef6\u4e8b\u8981\u505a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5c07 list item \u8a2d\u5b9a\u70ba absolute\uff0c\u4e26\u4e14\u8a2d\u5b9a top \u70ba\u7b2c i \u7684 item \u61c9\u8a72\u8981\u6709\u7684\u4f4d\u7f6e")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u53d6\u5f97\u73fe\u5728\u6efe\u52d5\u7684\u9ad8\u5ea6")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u8a08\u7b97\u51fa\u756b\u9762\u4e2d\u4e00\u958b\u59cb\u548c\u7d50\u675f\u7684\u5143\u7d20\u4f4d\u7f6e"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u958b\u59cb\u7684\u5143\u7d20\u4f4d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"startIndex"),"\uff1a\u5c31\u662f\u5728\u8996\u7a97\u525b\u958b\u59cb\u7684\u4f4d\u7f6e\uff0c\u8a08\u7b97\u65b9\u5f0f\u70ba\u8996\u7a97\u6efe\u52d5\u7684\u9ad8\u5ea6 (scrollTop) / \u6bcf\u500b item \u7684\u9ad8\u5ea6 (itemHeight)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u7d50\u675f\u7684\u5143\u7d20\u4f4d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"endIndex"),"\uff1a\u5c31\u662f\u5728\u8996\u7a97\u7d50\u675f\u7684\u4f4d\u7f6e\uff0c\u8a08\u7b97\u65b9\u5f0f\u70ba\u8996\u7a97\u6efe\u52d5\u7684\u9ad8\u5ea6 (scrollTop) + \u8996\u7a97\u9ad8\u5ea6 (windowHeight) / \u6bcf\u500b item \u7684\u9ad8\u5ea6 (itemHeight)")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u50c5\u6e32\u67d3 ",(0,r.kt)("inlineCode",{parentName:"p"},"startIndex")," \u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"endIndex")," \u7684\u5143\u7d20"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import { useState } from "react";\n\nconst itemHeight = 35; // Adjustable global variable\nconst windowHeight = 500;\n\nconst ListItem = ({ index }) => {\n  return (\n    <li\n      style={{\n        height: `${itemHeight}px`,\n        // highlight-start\n        // STEP 1. \u5c07 list item \u8a2d\u5b9a\u70ba absolute\uff0c\u4e26\u4e14\u8a2d\u5b9a top \u70ba\u7b2c i \u7684 item \u61c9\u8a72\u8981\u6709\u7684\u4f4d\u7f6e\n        top: `${itemHeight * index}px`,\n        backgroundColor: index % 2 === 0 ? \'#f0f0f0\' : \'white\'\n      }}\n      className="text-center absolute w-full leading-9"\n      // highlight-end\n    >\n      List Item Index - {index}\n    </li>\n  );\n};\n\nconst VirtualizedList = ({\n  numberOfItems,\n}) => {\n  // highlight-start\n  // STEP 2. \u8a08\u7b97\u51fa\u756b\u9762\u4e2d\u4e00\u958b\u59cb\u548c\u7d50\u675f\u7684\u5143\u7d20\u4f4d\u7f6e\n  const [scrollTop, setScrollTop] = useState(0);\n  const startIndex = Math.floor(scrollTop / itemHeight);\n  const endIndex = Math.floor((scrollTop + windowHeight) / itemHeight);\n  // highlight-end\n\n  // highlight-start\n  // STEP 3. \u50c5\u6e32\u67d3 `startIndex` \u5230 `endIndex` \u7684\u5143\u7d20\n  const listItems = (() => {\n    const items = [];\n    for (let i = startIndex; i <= endIndex; i++) {\n      items.push(<ListItem key={i} index={i} />);\n    }\n    return items;\n  })();\n  // highlight-end\n\n\n  return (\n    <ul\n      // highlight-start\n      // STEP 1. \u5c07 ul \u8a2d\u5b9a\u70ba relative\n      className="overflow-y-scroll w-full h-[500px] border-2 border-black relative"\n      // STEP 2. \u53d6\u5f97\u73fe\u5728\u6efe\u52d5\u7684\u9ad8\u5ea6\n      onScroll={(e) => {\n        setScrollTop(e.currentTarget.scrollTop);\n      }}\n      // highlight-end\n    >\n      {listItems}\n    </ul>\n  );\n};\n\nexport const numberOfItems = 100000;\n\nexport default function Virtualized() {\n  return (\n    <div className="flex flex-col items-center justify-center h-[100vh]">\n      <h1 className="pb-4">Rendering {numberOfItems.toLocaleString()}</h1>\n      <VirtualizedList numberOfItems={numberOfItems} />\n    </div>\n  );\n}\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u4ee5\u4e0b\u5c31\u662f\u6211\u5011\u7684\u6210\u679c\uff01"),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/ZDYvKafPLZQ?si=p2WNxomFtVcXZ6Ag",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"2-\u6d41\u66a2\u5730\u6efe\u52d5"},"2. \u6d41\u66a2\u5730\u6efe\u52d5"),(0,r.kt)("p",null,"\u96d6\u7136\u6211\u5011\u53ef\u4ee5\u6210\u529f\u7684\u53ea\u986f\u793a\u51fa\u756b\u9762\u53ef\u898b\u7684\u5143\u7d20\uff0c\u4f46\u76ee\u524d\u7684\u5be6\u4f5c\u6709\u500b\u554f\u984c\uff0c\u5c31\u662f scroll bar \u7684\u9577\u5ea6\u6703\u52d5\u614b\u7684\u8b8a\u5c0f\n\u6703\u9020\u6210\u9019\u6a23\u7684\u539f\u56e0\u662f\uff0c\u662f\u56e0\u70ba\u53ef\u898b\u7684 0th item \u7684 top \u4f4d\u7f6e\u6703\u6839\u64da index \u800c\u905e\u589e\uff0c\u4f8b\u5982\u7bc4\u4f8b\u4e2d\u96d6\u7136\u6211\u5011\u90fd\u53ea\u986f\u793a 500 / 35 = 14 \u500b\u5143\u7d20\uff0c\u4f46\u662f"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u53ef\u898b 0th index \u70ba 0 \u6642\uff0ctop \u70ba 0\uff0c\u6574\u4e32 list \u7684\u9ad8\u5ea6\u70ba 35 * 14 = 490"),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u898b 0th index \u70ba 30 \u6642\uff0ctop \u70ba 35 ",(0,r.kt)("em",{parentName:"li"}," 30 = 1050\uff0c\u6574\u4e32 list \u7684\u9ad8\u5ea6\u70ba 35 ")," (30 + 14) = 1470 (30 \u70ba window \u4e0a\u770b\u4e0d\u898b\u5f97\u7a7a\u767d\u90e8\u5206)"),(0,r.kt)("li",{parentName:"ul"},"\u53ef\u898b 0th index \u70ba 100 \u6642\uff0ctop \u70ba 35 ",(0,r.kt)("em",{parentName:"li"}," 100 = 3500\uff0c\u6574\u4e32 list \u7684\u9ad8\u5ea6\u70ba 35 ")," (100 + 14) = 4900 (100 \u70ba window \u4e0a\u770b\u4e0d\u898b\u5f97\u7a7a\u767d\u90e8\u5206)"),(0,r.kt)("li",{parentName:"ul"},"...")),(0,r.kt)("p",null,"\u6240\u4ee5\u5c0d ul \u4f86\u8aaa\uff0c\u6240\u6709 list items \u7684\u9577\u5ea6\u662f\u52d5\u614b\u7684\uff0c\u9032\u800c\u9020\u6210 scroll bar \u7684\u9577\u5ea6\u4e5f\u6703\u52d5\u614b\u7684\u8b8a\u5c0f\uff0c\u914d\u5408 list items \u5be6\u969b\u7684\u9577\u5ea6"),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u70ba\u4e86\u4fee\u6b63\u9019\u500b\u554f\u984c\uff0c\u6211\u5011\u53ef\u4ee5\u628a\u6574\u500b ul \u7684\u9ad8\u5ea6\u8a2d\u70ba\u6240\u6709 list items \u7684\u9ad8\u5ea6\uff0c\u4ee5\u7bc4\u4f8b\u4f86\u8aaa\u5c31\u662f 35 * (100,000) = 3,500,000\uff0c\n\u9019\u6a23 scroll bar \u5c31\u6703\u56fa\u5b9a\u4e0d\u8b8a\u4e86\uff0c\u4fee\u6b63\u7684\u7a0b\u5f0f\u78bc\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'const VirtualizedList = ({\n  numberOfItems,\n}) => {\n  const [scrollTop, setScrollTop] = useState(0);\n  const startIndex = Math.floor(scrollTop / itemHeight);\n  const endIndex = Math.floor((scrollTop + windowHeight) / itemHeight);\n\n  // highlight-start\n  const totalHeight = numberOfItems * itemHeight;\n  // highlight-end\n\n  const listItems = (() => {\n    const items = [];\n    for (let i = startIndex; i <= endIndex; i++) {\n      items.push(<ListItem key={i} index={i} />);\n    }\n    return items;\n  })();\n\n\n  return (\n    <ul\n      className="overflow-y-scroll w-full h-[500px] border-2 border-black relative"\n      style={{ height: `${windowHeight}px` }}\n      onScroll={(e) => {\n        setScrollTop(e.currentTarget.scrollTop);\n      }}\n    >\n      {/* highlight-start */}\n      <div style={{\n        height: `${totalHeight}px`\n      }}>\n      {/* highlight-end */}\n        {listItems}\n      </div>\n    </ul>\n  );\n};\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u4ee5\u4e0b\u5c31\u662f\u6211\u5011\u4fee\u6b63\u7684\u6210\u679c\uff5e"),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/xU1N9W8hyvs?si=ElRGt1u1ux1pJR8Y",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"3-\u52a0\u4e0a\u524d\u5f8c-preload-\u7684\u5143\u7d20"},"3. \u52a0\u4e0a\u524d\u5f8c preload \u7684\u5143\u7d20"),(0,r.kt)("p",null,"\u96d6\u7136\u6211\u5011\u89e3\u6c7a\u4e86 scroll bar \u7684\u554f\u984c\uff0c\u4f46\u5728\u5f80\u4e0b\u6216\u5f80\u4e0a\u6efe\u52d5\u6642\uff0c\u6703\u6709\u77ed\u66ab\u7684\u7a7a\u767d\u5340\u584a\uff0c\u9019\u662f\u56e0\u70ba\u65b0\u7684\u5143\u7d20\u8a08\u7b97\u5b8c\u5f8c\uff0c\u9084\u6c92\u6709\u88ab\u6e32\u67d3\u51fa\u4f86"),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u70ba\u4e86\u907f\u514d\u9019\u500b\u554f\u984c\uff0c\u6211\u5011\u53ef\u4ee5\u9810\u5148\u6e32\u67d3\u524d\u5f8c\u5e7e\u500b\u5143\u7d20\uff0c\u4ee5\u7bc4\u4f8b\u4f86\u8aaa\uff0c\u6211\u5011\u53ef\u4ee5\u5728\u4e0a\u4e0b\u591a\u5148\u6e32\u67d3 10 \u500b\u5143\u7d20\uff0c\u4fee\u6b63\u7684\u7a0b\u5f0f\u78bc\u5982\u4e0b"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"\u9019\u908a\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6211\u5011\u5728\u8a08\u7b97\u5305\u542b preload \u7684 startIndex \u548c endIndex \u6642\uff0c\u8981\u6ce8\u610f"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"preloadStartIndex")," \u4e0d\u80fd\u5c0f\u65bc 0\uff0c\u4e0d\u7136 list item \u6703\u5f9e\u8ca0\u7684\u958b\u59cb"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"preloadEndIndex")," \u4e0d\u80fd\u5927\u65bc ",(0,r.kt)("inlineCode",{parentName:"li"},"numberOfItems"),"\uff0c\u4e0d\u7136 list item \u6703\u8d85\u51fa\u7bc4\u570d"))),(0,r.kt)("br",null),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'// highlight-start\nconst preloadCount = 10;\n// highlight-end\n\nconst VirtualizedList = ({\n  numberOfItems,\n}) => {\n  const [scrollTop, setScrollTop] = useState(0);\n  \n  const startIndex = Math.floor(scrollTop / itemHeight);\n  // highlight-start\n  const preloadStartIndex = Math.max(0, startIndex - preloadCount);\n  // highlight-end\n\n  const endIndex = Math.floor((scrollTop + windowHeight) / itemHeight);\n  // highlight-start\n  const preloadEndIndex = Math.min(numberOfItems, endIndex + preloadCount);\n  // highlight-end\n\n  const totalHeight = numberOfItems * itemHeight;\n\n  const listItems = (() => {\n    const items = [];\n    // highlight-start\n    for (let i = preloadStartIndex; i <= preloadEndIndex; i++) {\n    // highlight-end\n      items.push(<ListItem key={i} index={i} />);\n    }\n    return items;\n  })();\n\n\n  return (\n    <ul\n      className="overflow-y-scroll w-full h-[500px] border-2 border-black relative"\n      style={{ height: `${windowHeight}px` }}\n      onScroll={(e) => {\n        setScrollTop(e.currentTarget.scrollTop);\n      }}\n    >\n      <div style={{\n        height: `${totalHeight}px`\n      }}>\n        {listItems}\n      </div>\n    </ul>\n  );\n};\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("p",null,"\u7d93\u904e\u6700\u5f8c\u7684\u4fee\u6b63\u5f8c\uff0c\u6211\u5011\u5c31\u5b8c\u6210\u4e00\u500b\u7c21\u55ae\u7684 react virtualized \u4e86\uff01"),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/AFqA9lG7G48?si=fHGk6WZ8c-jYG0zi",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:!0}),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"\u512a\u5316"},"\u512a\u5316"),(0,r.kt)("h3",{id:"css-transform"},"CSS ",(0,r.kt)("inlineCode",{parentName:"h3"},"transform")),(0,r.kt)("p",null,"\u9664\u4e86\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"position: absolute")," \u5916\uff0c\u6211\u5011\u4e5f\u53ef\u4ee5\u4f7f\u7528 CSS ",(0,r.kt)("inlineCode",{parentName:"p"},"transform")," \u4f86\u9054\u5230\u76f8\u540c\u7684\u6548\u679c\uff0c\n\u800c\u4e14\u53ef\u4ee5\u76e1\u91cf\u907f\u514d\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"position: absolute")," \u9020\u6210\u983b\u7e41 reflow \u7684\u60c5\u6cc1\uff0c\u50c5\u5229\u7528 repaint \u4f86\u9054\u5230\u6548\u679c"),(0,r.kt)("p",null,"\u5be6\u4f5c\u65b9\u5f0f\u8ddf\u4e0a\u9762\u5927\u540c\u5c0f\u7570\uff0c\u50c5\u5dee"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6211\u5011\u53ea\u8a08\u7b97 ",(0,r.kt)("inlineCode",{parentName:"li"},"startIndex")),(0,r.kt)("li",{parentName:"ul"},"\u8a08\u7b97\u8981\u6e32\u67d3\u7684\u5143\u7d20\u6578\u91cf\uff0c\u6b64\u8655\u70ba 500/35 + 2 * 10 = 14 + 20 = 34 \u500b item\uff0c\u82e5\u5269\u4e0b\u6578\u91cf\u5c0f\u65bc 34 \u500b item\uff0c\u5247\u53ea\u6e32\u67d3\u5269\u4e0b\u7684 item\uff0c\u76f4\u5230\u53ea\u5269\u525b\u597d\u586b\u6eff windowHeight \u7684\u6578\u91cf"),(0,r.kt)("li",{parentName:"ul"},"\u5229\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"transform: translateY"),"\uff0c\u5c07\u6574\u500b\u5217\u8868\u90e8\u5206\u5f80\u4e0b\u63a8")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'const VirtualizedList = ({\n  numberOfItems,\n}) => {\n  const [scrollTop, setScrollTop] = useState(0);\n\n  const startIndex = Math.floor(scrollTop / itemHeight);\n\n  // highlight-start\n  // \u5f9e startIndex \u958b\u59cb\uff0c\u539f\u672c\u6703\u9810\u8a2d\u6e32\u67d3 floor(500 / 35) + 2 * 10 = 14 + 20 = 34 \u500b item\n  // \u4f46\u6700\u5f8c\u5269\u4e0b\u53ea\u5920\u6e32\u67d3\u4e0d\u5230 34 \u500b item \u6642\uff0c\u5247\u53ea\u6e32\u67d3\u5269\u4e0b\u7684 item\uff0c\u76f4\u5230\u53ea\u5269 14 \u500b item\n  const renderedCount = Math.floor(windowHeight / itemHeight) + 2 * preloadCount;\n  const restItemsCount = numberOfItems - startIndex;\n\n  const preloadedRenderedCount = Math.min(restItemsCount, renderedCount);\n  // highlight-end\n  \n  const totalHeight = numberOfItems * itemHeight;\n\n  const listItems = (() => {\n    const items = [];\n    // highlight-start\n    for (let i = 0; i <= preloadedRenderedCount; i++) {\n      const index = startIndex + i;\n      items.push(<ListItem key={index} index={index} />);\n      // highlight-end\n    }\n    return items;\n  })();\n\n\n  return (\n    <ul\n      className="overflow-y-scroll w-full h-[500px] border-2 border-black"\n      style={{ height: `${windowHeight}px` }}\n      onScroll={(e) => {\n        setScrollTop(e.currentTarget.scrollTop);\n      }}\n    >\n      <div style={{\n        height: `${totalHeight}px`\n      }}>\n        {/* highlight-start */}\n        <div style={{\n          transform: `translateY(${startIndex * itemHeight}px)`\n        }}>\n        {/* highlight-end */}\n          {listItems}\n        </div>\n      </div>\n    </ul>\n  );\n};\n')),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"\u7d50\u8ad6"},"\u7d50\u8ad6"),(0,r.kt)("p",null,"React Virtualized \u7684\u5be6\u4f5c\u53ea\u9700\u8981 3 \u6b65\u9a5f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8a08\u7b97\u51fa\u756b\u9762\u4e2d\u4e00\u7684 startIndex \u548c endIndex\uff08\u6216\u8005\u662f\u9700\u8981\u6e32\u67d3\u7684\u6578\u91cf\uff09\uff0c\u4e26\u4e14\u53ea\u6e32\u67d3\u51fa ",(0,r.kt)("inlineCode",{parentName:"li"},"startIndex")," \u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"endIndex")," \u7684\u5143\u7d20"),(0,r.kt)("li",{parentName:"ol"},"\u70ba\u4e86\u4fdd\u6301\u6372\u8ef8\u5927\u5c0f\u4e00\u81f4\uff0c\u6efe\u52d5\u7a7a\u9593\u8981\u7dad\u6301\u4e00\u6a23\u5927\uff0c\u6240\u4ee5\u8981\u76f4\u63a5\u7d66\u5b9a\u6574\u500b list \u7684\u9ad8\u5ea6\uff0c\u5c31\u7b97\u5be6\u969b\u4e0a\u53ea\u6709\u756b\u9762\u53ef\u898b items"),(0,r.kt)("li",{parentName:"ol"},"\u52a0\u4e0a\u524d\u5f8c preload \u7684\u5143\u7d20\uff0c\u907f\u514d\u6efe\u52d5\u6642\u9020\u6210\u7a7a\u767d\u5340\u584a"),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"CSS transform")," \u4f86\u53d6\u4ee3 ",(0,r.kt)("inlineCode",{parentName:"li"},"position: absolute"),"\uff0c\u907f\u514d\u983b\u7e41\u7684 reflow")),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("h3",{id:"\u53c3\u8003\u8cc7\u6599"},"\u53c3\u8003\u8cc7\u6599"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=Yz4eK-4LKXg"},"Let's Build a VIRTUALIZED LIST from Scratch in React.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev.to/adamklein/build-your-own-virtual-scroll-part-i-11ib"},"Build your Own Virtual Scroll - Part I")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev.to/adamklein/build-your-own-virtual-scroll-part-ii-3j86"},"Build your own virtual scroll - Part II")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://codesandbox.io/p/sandbox/virtual-scroll-dynamic-heights-using-hooks-forked-mtqd54?file=%2Fsrc%2FVirtualScroll.js%3A37%2C7-37%2C20"},"virtual-scroll-dynamic-heights-using-hooks"))),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("br",null))}p.isMDXComponent=!0}}]);