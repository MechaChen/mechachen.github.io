"use strict";(self.webpackChunkbenson_doc=self.webpackChunkbenson_doc||[]).push([[5853],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=s(n),f=o,m=p["".concat(c,".").concat(f)]||p[f]||u[f]||a;return n?r.createElement(m,i(i({ref:t},d),{},{components:n})):r.createElement(m,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=f;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},8003:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var r=n(7462),o=(n(7294),n(3905));const a={sidebar_position:3.4,sidebar_label:"[Google Docs] Interface",title:"[Google Docs] Interface",tags:["System Design","Interface"]},i=void 0,l={unversionedId:"Plan/google-doc-system-interface",id:"Plan/google-doc-system-interface",title:"[Google Docs] Interface",description:"Interface",source:"@site/docs/Plan/google-doc-system-interface.mdx",sourceDirName:"Plan",slug:"/Plan/google-doc-system-interface",permalink:"/zh-tw/docs/Plan/google-doc-system-interface",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Plan/google-doc-system-interface.mdx",tags:[{label:"System Design",permalink:"/zh-tw/docs/tags/system-design"},{label:"Interface",permalink:"/zh-tw/docs/tags/interface"}],version:"current",lastUpdatedAt:1748482728,formattedLastUpdatedAt:"2025\u5e745\u670829\u65e5",sidebarPosition:3.4,frontMatter:{sidebar_position:3.4,sidebar_label:"[Google Docs] Interface",title:"[Google Docs] Interface",tags:["System Design","Interface"]},sidebar:"tutorialSidebar",previous:{title:"[Google Docs] Data Model",permalink:"/zh-tw/docs/Plan/google-doc-system-data-model"},next:{title:"[Google Docs] Optimization - Binary encoding",permalink:"/zh-tw/docs/Plan/google-doc-system-optimization-binary-encoding"}},c={},s=[{value:"Interface",id:"interface",level:2},{value:"Editor to Server interface",id:"editor-to-server-interface",level:3},{value:"Update/Save action",id:"updatesave-action",level:3},{value:"Acknowledge action",id:"acknowledge-action",level:3},{value:"Peer update action",id:"peer-update-action",level:3},{value:"References",id:"references",level:2}],d={toc:s},p="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"interface"},"Interface"),(0,o.kt)("p",null,"For collaborative editing, we will have 2 types of interface:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Client to Editor interface"),(0,o.kt)("li",{parentName:"ol"},"Editor to Server interface")),(0,o.kt)("br",null),(0,o.kt)("p",null,"We will focus on the ",(0,o.kt)("strong",{parentName:"p"},"Editor to Server interface")," in this document."),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"editor-to-server-interface"},"Editor to Server interface"),(0,o.kt)("p",null,"Since the collaborative editing is a real-time behavior(WebSocket), the APIs are usually called actions/events."),(0,o.kt)("p",null,"Here we have 3 types of actions in collaborative editing:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Update/Save action"),(0,o.kt)("li",{parentName:"ol"},"Acknowledge action"),(0,o.kt)("li",{parentName:"ol"},"Peer update action")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"updatesave-action"},"Update/Save action"),(0,o.kt)("p",null,"The update/save action is the user's new edit data plan to send to server and store in the document."),(0,o.kt)("p",null,"here is the Update action payload example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'{\n  "type": "UPDATE",\n  "requestId": 19, // increase monotonically by every request from client session start,\n  "revision": 100, // current document version when the update is sent\n  "operations": [\n    {\n      "type": "INSERT",\n      "nodeId": 30, // help to find the node efficiently in the document node map\n      "payload": {\n        "characters": "IKEA"\n        "index": 4, // the operation occur position from the node start\n      }\n    },\n    {\n      "type": "INSERT",\n      "nodeId": 31, // help to find the node efficiently in the document node map\n      "payload": {\n        "characters": "Shark"\n        "index": 2, // the operation occur position from the node start\n      }\n    },\n  ]\n}\n')),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"acknowledge-action"},"Acknowledge action"),(0,o.kt)("p",null,"This action is used to acknowledge the client the update is received and stored in the document."),(0,o.kt)("p",null,"Then remove the corresponding request from the send buffer."),(0,o.kt)("p",null,"Once the send buffer is empty, the client will send the batch of local buffer update to server."),(0,o.kt)("mermaid",{value:"flowchart TB\nid1[ACK with requestAcknowledgedId C] --\x3e id2[remove client send buffer requestId C]\nid2 --\x3e id3[until send buffer is empty]\nid3 --\x3e id4[send batch of local buffer update to server]"}),(0,o.kt)("br",null),(0,o.kt)("p",null,"here is the Acknowledge action payload example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "type": "ACK",\n  "requestIdAcknowledged": 2,\n  "requestId": 3,\n  "revision": 147\n}\n')),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"peer-update-action"},"Peer update action"),(0,o.kt)("p",null,"This action is used to notify the client there are new updates from peers."),(0,o.kt)("p",null,"here is the Peer update action payload example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "type": "PEER_UPDATE",\n  "revision": 101,\n  "userId": 6543, // User who made the update\n  "operations": [\n    {\n      "type": "INSERT",\n      "nodeId": 24, // Needed in a document context to identify the node to modify\n      "payload": {\n        "characters": "Goodbye",\n        "index": 8\n      }\n    },\n    {\n      "type": "INSERT",\n      "nodeId": 25,\n      "payload": {\n        "characters": " see you next time",\n        "index": 4,\n      }\n    }\n  ]\n}\n\n')),(0,o.kt)("br",null),(0,o.kt)("br",null),(0,o.kt)("h2",{id:"references"},"References"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.greatfrontend.com/questions/system-design/collaborative-editor-google-docs#interface-definition-api"},"GreatFrontend - Google Docs"))),(0,o.kt)("br",null),(0,o.kt)("br",null))}u.isMDXComponent=!0}}]);